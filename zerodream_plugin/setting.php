
<?php

/*
    Powered by ZeroDream
    Optimized by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 !defined('DEBUG') AND exit('Access Denied.'); if($method == 'GET') { $timeout = $zd_kv_zerodream_plugin['_zd_plugin_data']['zd_plugin_key_apply']['apply_timeout']; $zd_uniqid = zd_uniqid($prefix=''); $apply_url = xn_urlencode($zd_scheme_host); $zd_plugin_setting['key'] = $zd_kv_zerodream_plugin['key']; $zd_plugin_setting['key_apply_timeout'] = $timeout; $zd_plugin_setting['key_apply_url'] = ZERODREAM_URL."zd_plugin-user-key_apply-$zd_uniqid-$apply_url.htm"; $zd_plugin_setting['key_query_url'] = url("../zd_plugin_user-key_query"); include _include(APP_PATH.'plugin/zerodream_plugin/admin/view/htm/zd_plugin_setting_start.inc.htm');?><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><div class="row"> <div class="col-lg-8 mx-auto"> <form action="<?php echo url("_plugin-zerodream_plugin_setting-$dir");?>" method="post" id="form"> <div class="form-group"> <div class="alert alert-warning"> <a href="https://www.zerodream.top/" target="_blank" style="color:#7d6828;"> 零梦网站：www.zerodream.top </a> </div> </div> <div id="key" class="form-group"> <h5 class="text-center">基本设置</h5> <div class="mb-2"> <div class="input-group"> <div class="input-group-prepend"> <div class="input-group-text" style="width:80px;display:block;"> key </div> </div> <input id="key_input" class="form-control" type="text" name="key" value="<?php echo $zd_plugin_setting['key'];?>" placeholder="key" style="width:60%;background-color:white;"> </div> </div> <div class="row mb-2" style="margin-right:0;margin-left:0;justify-content:center;"> <div class="mr-2"> <a role="button" class="btn btn-primary" id="button_key_apply" href="<?php echo $zd_plugin_setting['key_apply_url'];?>" onclick="zd_key_apply();" target="_blank"> 申请 key </a> </div> <div class="mr-2"> <a role="button" class="btn btn-primary" href="javascript:;" onclick="zd_key_copy()"> 复制 key </a> </div> </div> </div> <div class="form-group"> <h5 class="text-center">插件帐户</h5> <div class="row mb-2" style="margin-right:0;margin-left:0;justify-content:center;"> <div class="mr-2"> <a role="button" class="btn btn-primary" href="https://www.zerodream.top/zd_plugin-user-read.htm" target="_blank"> 查看信息 </a> </div> <div class="mr-2"> <a role="button" class="btn btn-primary" href="https://www.zerodream.top/zd_plugin-user-setting.htm" target="_blank"> 用户设置 </a> </div> </div> </div> <div class="form-group"> <button type="submit" class="btn btn-primary btn-block" id="submit" data-loading-text="<?php echo lang('submiting');?>..."> <?php echo lang('confirm');?> </button> </div> </form> <div class="form-group"> <a role="button" class="btn btn-secondary btn-block mt-3" href="javascript:history.back();"> <?php echo lang('back');?> </a> </div> </div></div><?php include _include(APP_PATH.'plugin/zerodream_plugin/admin/view/htm/zd_plugin_setting_end.inc.htm');?><script> var jform = $("#form"); var jsubmit = $("#submit"); var referer = location.href; jform.on('submit', function(){ jform.reset(); jsubmit.button('loading'); var postdata = jform.serialize(); $.xpost(jform.attr('action'), postdata, function(code, message) { if(code == 0) { $.alert(message); jsubmit.button(message).delay(1000).location(); } else { $.alert(message); jsubmit.button('reset'); } }); return false; });</script><script> var timeout = new Date().getTime() + <?php echo $zd_plugin_setting['key_apply_timeout'];?>; var button_key_apply = $('#button_key_apply'); function zd_key_apply() { button_key_apply.button('loading'); _zd_key_apply(); } function _zd_key_apply() { var current_time = new Date().getTime(); var post_url = '<?php echo $zd_plugin_setting['key_query_url'];?>'; var post_data = {'apply_id':'<?php echo $zd_uniqid;?>', 'apply_url':'<?php echo $apply_url;?>'}; if(timeout<=current_time) { var message = '申请超时'; $.alert(message); button_key_apply.button(message).delay(3000).location(); return; } $.xpost(post_url, post_data, function(code, message) { if(code==0) { $.alert(message); button_key_apply.button(message).delay(3000).location('<?php echo url('_plugin-zerodream_plugin_cloud-index');?>'); } else if(code==1) { $.alert(message); button_key_apply.button(message).delay(3000).location(); } else if(code==2) { setTimeout('_zd_key_apply();', 3000); } else if(code==3) { $.alert(message); button_key_apply.button(message).delay(3000).location(); } }); }</script><script> function zd_key_copy() { var key_input = document.getElementById("key_input"); key_input.select(); document.execCommand("copy"); $.alert("复制成功"); }</script> <?php  } else { $key = param('key'); $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); $zd_kv_zerodream_plugin['key'] = $key; zd_kv_set('zerodream_plugin', $zd_kv_zerodream_plugin); message(0, '修改成功'); } ?>