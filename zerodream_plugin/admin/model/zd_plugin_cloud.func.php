
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_cloud_dir() { $zd_a09900 = '../data/zerodream_plugin/cache/zd_plugin_cloud/'; if(!is_dir($zd_a09900)) mkdir($zd_a09900); } function zd_plugin_cloud_data() { global $conf,$url_rewrite_on,$url_record,$url_request,$zd_kv_zerodream_plugin,$filename_cache; $zd_9aaf70 = zd_request_uri(); $url_rewrite_on = $conf['url_rewrite_on']; $url_record = substr($zd_9aaf70, $url_rewrite_on?14:15); $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); if(empty($zd_kv_zerodream_plugin['key'])) message(-1, jump('请设置 key', url('plugin-setting-zerodream_plugin').'#key', 3)); $zd_f4bc32 = md5($url_request); $filename_cache = "../data/zerodream_plugin/cache/zd_plugin_cloud/$zd_f4bc32"; } function zd_plugin_cloud_url_record() { global $url_route,$url_record; $zd_eb4140 = zd_plugin_url_record_get(); $zd_eb4140['zd_plugin_information']['action'] = 'zd_plugin_plugin_cloud'; $zd_eb4140['zd_plugin_plugin_cloud']['zd_plugin_information']['url_route'] = $url_route; $zd_eb4140['zd_plugin_plugin_cloud'][$url_route]['url_record'] = $url_record; $zd_eb4140['zd_plugin_plugin_read']['back_action'] = 'zd_plugin_plugin_cloud'; zd_plugin_url_record_put($zd_eb4140); } function zd_plugin_cloud_get_information() { global $information,$zd_kv_zerodream_plugin; $zd_473810 = $zd_kv_zerodream_plugin['key']; $zd_8d2c11 = explode("_", $zd_473810); $information['uid'] = $zd_8d2c11[0]; $information['key'] = $zd_8d2c11[1]; $information['check'] = $zd_8d2c11[2]; } function zd_plugin_cloud_index() { global $zd_kv_zerodream_plugin; if($zd_kv_zerodream_plugin['cache']) zd_plugin_cloud_cache(); else zd_plugin_cloud_non_cache(); } function zd_plugin_cloud_cache() { global $time,$zd_plugin_conf,$_cache,$filename_cache,$response,$zd_plugin_cloud; $zd_d67540 = $zd_plugin_conf['cache_time']; if($_cache) { zd_plugin_cloud_request(); $zd_f42981 = $response; file_put_contents($filename_cache, $zd_f42981); message(0, '缓存成功'); } if(is_file($filename_cache)) { $response = file_get_contents($filename_cache); } else { zd_plugin_cloud_request(); $zd_f42981 = $response; file_put_contents($filename_cache, $zd_f42981); } $zd_d56c55 = 'zd_plugin_cloud'; $zd_f42981 = $response; $zd_be05d7 = zd_data_unzip($zd_d56c55, $zd_f42981); $zd_f42981 = $zd_be05d7['data']; $zd_5c8b212 = $zd_be05d7['html']; $zd_b64f614 = $zd_be05d7['script']; $zd_e01d416 = json_decode($zd_f42981, true); $zd_e03a518 = $zd_e01d416['zd_plugin_information']; $zd_6a54e20 = $zd_e03a518['cache']; $zd_9169722 = $zd_e03a518['create_time']; $zd_f93f324 = zd_kv_get('zerodream_plugin'); $zd_f93f324['cache'] = $zd_6a54e20; zd_kv_set('zerodream_plugin', $zd_f93f324); if(!$zd_6a54e20) { zd_plugin_cloud_non_cache();return; } $zd_73a3229 = $zd_9169722 + $zd_d67540; if($time>=$zd_73a3229) { zd_plugin_cloud_request(); $zd_f42981 = $response; file_put_contents($filename_cache, $zd_f42981); } $zd_plugin_cloud['cache'] = true; $zd_plugin_cloud['html'] = $zd_5c8b212; $zd_plugin_cloud['script'] = $zd_b64f614; } function zd_plugin_cloud_non_cache() { global $filename_cache,$response,$zd_plugin_cloud; zd_plugin_cloud_request(); $zd_6a2080 = $response; file_put_contents($filename_cache, $zd_6a2080); $zd_4276b2 = 'zd_plugin_cloud'; $zd_6a2080 = $response; $zd_3861e4 = zd_data_unzip($zd_4276b2, $zd_6a2080); $zd_6a2080 = $zd_3861e4['data']; $zd_e3f939 = $zd_3861e4['html']; $zd_083a711 = $zd_3861e4['script']; $zd_46cfb13 = json_decode($zd_6a2080, true); $zd_e8c2815 = $zd_46cfb13['zd_plugin_information']; $zd_e563017 = $zd_e8c2815['cache']; $zd_84e9c19 = zd_kv_get('zerodream_plugin'); $zd_84e9c19['cache'] = $zd_e563017; zd_kv_set('zerodream_plugin', $zd_84e9c19); if($zd_e563017) { zd_plugin_cloud_cache();return; } $zd_plugin_cloud['cache'] = false; $zd_plugin_cloud['html'] = $zd_e3f939; $zd_plugin_cloud['script'] = $zd_083a711; } function zd_plugin_cloud_request() { global $url_record,$information,$url_rewrite_on,$url_request,$response; $zd_0f8a50 = $information['uid'].'_'.$information['key']; $zd_7df2c1 = '../plugin/zerodream_plugin/conf.json'; $zd_c8a832 = file_get_contents($zd_7df2c1); $zd_31a204 = json_decode($zd_c8a832, true); $zd_d18d86 = zd_plugin_zerodream_plugin_md5_file(); $zd_675777 = zd_plugin_zerodream_plugin_dir_existence(); $zd_c5e468['zd_plugin_information']['key'] = $zd_0f8a50; $zd_c5e468['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_c5e468['zd_plugin_information']['url_request'] = $url_request; $zd_c5e468['zd_plugin_information']['url_record'] = $url_record; $zd_c5e468['zd_plugin_information']['zerodream_plugin']['version'] = $zd_31a204['version']; $zd_c5e468['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_31a204['installed']; $zd_c5e468['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_31a204['enable']; $zd_c5e468['zd_plugin_information']['zerodream_plugin_md5'] = $zd_d18d86; $zd_c5e468['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_675777; $zd_7d0cd23 = json_encode($zd_c5e468); $zd_fec5025 = 'zd_plugin_cloud'; $zd_0610c26 = array('data'=>$zd_7d0cd23); $zd_7be6628 = zd_data_zip($zd_fec5025, $zd_0610c26); $zd_0017631 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_cloud"; $zd_f66f632 = zd_curl($zd_0017631, $zd_7be6628, $zd_d92d935="POST"); $zd_3e04336 = $zd_f66f632['data']; $zd_58af938 = $zd_f66f632['error']; if($zd_58af938) message(-1, "curl_error: $zd_58af938"); elseif(!$zd_3e04336) message(-1, '数据不存在'); $response = $zd_3e04336; } ?>