
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_cloud_dir() { $zd_53a0f_0 = '../data/zerodream_plugin/cache/zd_plugin_cloud/'; if(!is_dir($zd_53a0f_0)) mkdir($zd_53a0f_0); } function zd_plugin_cloud_data() { global $conf,$url_rewrite_on,$url_record,$url_request,$zd_kv_zerodream_plugin,$filename_cache,$zd_plugin_cloud; $zd_3b390_0 = zd_request_uri(); $url_rewrite_on = $conf['url_rewrite_on']; $url_record = substr($zd_3b390_0, $url_rewrite_on?14:15); $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); if(empty($zd_kv_zerodream_plugin['key'])) message(-1, jump('请设置 key', url('plugin-setting-zerodream_plugin').'#key', 3)); $zd_adb95_2 = md5($url_request); $filename_cache = "../data/zerodream_plugin/cache/zd_plugin_cloud/$zd_adb95_2"; $zd_plugin_cloud = array(); } function zd_plugin_cloud_url_record() { global $url_route,$url_record; $zd_3a83e_0 = zd_plugin_url_record_get(); $zd_3a83e_0['zd_plugin_information']['action'] = 'zd_plugin_plugin_cloud'; $zd_3a83e_0['zd_plugin_plugin_cloud']['zd_plugin_information']['url_route'] = $url_route; $zd_3a83e_0['zd_plugin_plugin_cloud'][$url_route]['url_record'] = $url_record; $zd_3a83e_0['zd_plugin_plugin_read']['back_action'] = 'zd_plugin_plugin_cloud'; zd_plugin_url_record_put($zd_3a83e_0); } function zd_plugin_cloud_get_information() { global $information,$zd_kv_zerodream_plugin; $zd_160e3_0 = $zd_kv_zerodream_plugin['key']; $zd_e1484_1 = explode("_", $zd_160e3_0); $information['uid'] = $zd_e1484_1[0]; $information['key'] = $zd_e1484_1[1]; $information['check'] = $zd_e1484_1[2]; } function zd_plugin_cloud_index() { global $zd_kv_zerodream_plugin; if($zd_kv_zerodream_plugin['cache']) zd_plugin_cloud_cache(); else zd_plugin_cloud_non_cache(); } function zd_plugin_cloud_cache() { global $time,$zd_plugin_conf,$_cache,$filename_cache,$response,$zd_plugin_cloud; $zd_bcd34_0 = $zd_plugin_conf['cache_time']; if($_cache) { zd_plugin_cloud_request(); $zd_5ed33_1 = $response; file_put_contents($filename_cache, $zd_5ed33_1); message(0, '缓存成功'); } if(is_file($filename_cache)) { $response = file_get_contents($filename_cache); } else { zd_plugin_cloud_request(); $zd_5ed33_1 = $response; file_put_contents($filename_cache, $zd_5ed33_1); } $zd_f1288_5 = 'zd_plugin_cloud'; $zd_5ed33_1 = $response; $zd_7d66a_7 = zd_data_unzip($zd_f1288_5, $zd_5ed33_1); $zd_5ed33_1 = $zd_7d66a_7['data']; $zd_44f63_12 = $zd_7d66a_7['html']; $zd_b0777_14 = $zd_7d66a_7['script']; $zd_c896e_16 = json_decode($zd_5ed33_1, true); $zd_1c2a1_18 = $zd_c896e_16['zd_plugin_information']; $zd_89fd6_20 = $zd_1c2a1_18['cache']; $zd_0e6a5_22 = $zd_1c2a1_18['create_time']; $zd_67f48_24 = zd_kv_get('zerodream_plugin'); $zd_67f48_24['cache'] = $zd_89fd6_20; zd_kv_set('zerodream_plugin', $zd_67f48_24); if(!$zd_89fd6_20) {zd_plugin_cloud_non_cache();return;} $zd_70b03_29 = $zd_0e6a5_22 + $zd_bcd34_0; if($time>=$zd_70b03_29) { zd_plugin_cloud_request(); $zd_5ed33_1 = $response; file_put_contents($filename_cache, $zd_5ed33_1); zd_plugin_cloud_cache();return; } $zd_plugin_cloud['cache'] = true; $zd_plugin_cloud['html'] = $zd_44f63_12; $zd_plugin_cloud['script'] = $zd_b0777_14; } function zd_plugin_cloud_non_cache() { global $filename_cache,$response,$zd_plugin_cloud; zd_plugin_cloud_request(); $zd_ee328_0 = $response; file_put_contents($filename_cache, $zd_ee328_0); $zd_6312f_2 = 'zd_plugin_cloud'; $zd_ee328_0 = $response; $zd_c7603_4 = zd_data_unzip($zd_6312f_2, $zd_ee328_0); $zd_ee328_0 = $zd_c7603_4['data']; $zd_24b56_9 = $zd_c7603_4['html']; $zd_3e5d9_11 = $zd_c7603_4['script']; $zd_c8aeb_13 = json_decode($zd_ee328_0, true); $zd_fc940_15 = $zd_c8aeb_13['zd_plugin_information']; $zd_eba6d_17 = $zd_fc940_15['cache']; $zd_f076b_19 = zd_kv_get('zerodream_plugin'); $zd_f076b_19['cache'] = $zd_eba6d_17; zd_kv_set('zerodream_plugin', $zd_f076b_19); if($zd_eba6d_17) {zd_plugin_cloud_cache();return;} $zd_plugin_cloud['cache'] = false; $zd_plugin_cloud['html'] = $zd_24b56_9; $zd_plugin_cloud['script'] = $zd_3e5d9_11; } function zd_plugin_cloud_request() { global $url_record,$information,$url_rewrite_on,$url_request,$response; $zd_0b649_0 = $information['uid'].'_'.$information['key']; $zd_75330_1 = md5($information['uid'].'_'.$information['key'].'_'.$information['check']); $zd_a0060_2 = '../plugin/zerodream_plugin/conf.json'; $zd_b0dd7_3 = file_get_contents($zd_a0060_2); $zd_bd443_5 = json_decode($zd_b0dd7_3, true); $zd_023c0_7 = zd_plugin_zerodream_plugin_md5_file(); $zd_84779_8 = zd_plugin_zerodream_plugin_dir_existence(); $zd_0ead5_9['zd_plugin_information']['key'] = $zd_0b649_0; $zd_0ead5_9['zd_plugin_information']['check_key'] = $zd_75330_1; $zd_0ead5_9['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_0ead5_9['zd_plugin_information']['url_request'] = $url_request; $zd_0ead5_9['zd_plugin_information']['url_record'] = $url_record; $zd_0ead5_9['zd_plugin_information']['zerodream_plugin']['version'] = $zd_bd443_5['version']; $zd_0ead5_9['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_bd443_5['installed']; $zd_0ead5_9['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_bd443_5['enable']; $zd_0ead5_9['zd_plugin_information']['zerodream_plugin_md5'] = $zd_023c0_7; $zd_0ead5_9['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_84779_8; $zd_ec482_26 = json_encode($zd_0ead5_9); $zd_cb892_28 = 'zd_plugin_cloud'; $zd_10705_29 = array('data'=>$zd_ec482_26); $zd_691c8_31 = zd_data_zip($zd_cb892_28, $zd_10705_29); $zd_da8d0_34 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_cloud"; $zd_0f4c6_35 = zd_curl($zd_da8d0_34, $zd_691c8_31, array('method'=>'POST')); $zd_38e99_38 = $zd_0f4c6_35['data']; $zd_b11d7_40 = $zd_0f4c6_35['error']; if($zd_b11d7_40) message(-1, "curl_error: $zd_b11d7_40"); elseif(empty($zd_38e99_38)) message(-1, '数据不存在'); $response = $zd_38e99_38; } ?>