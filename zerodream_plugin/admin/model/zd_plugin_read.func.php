
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_read_dir() { $zd_5d955_0 = '../data/zerodream_plugin/cache/zd_plugin_read/'; if(!is_dir($zd_5d955_0)) mkdir($zd_5d955_0); } function zd_plugin_read_data() { global $conf,$plugin,$url_rewrite_on,$url_record,$zd_kv_zerodream_plugin,$filename_cache; $zd_4a813_0 = zd_request_uri(); $url_rewrite_on = $conf['url_rewrite_on']; $url_record = substr($zd_4a813_0, $url_rewrite_on?14:15); $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); if(!isset($zd_kv_zerodream_plugin['key'])) message(-1, jump('请设置 key', url('plugin-setting-zerodream_plugin').'#key', 3)); $zd_29b0a_2 = md5($plugin); $filename_cache = "../data/zerodream_plugin/cache/zd_plugin_read/$zd_29b0a_2"; } function zd_plugin_read_url_record() { global $plugin,$url_rewrite_on,$url_record,$zd_plugin_read; $zd_65776_0 = zd_plugin_url_record_get(); $zd_65776_0['zd_plugin_information']['action'] = 'zd_plugin_plugin_read'; $zd_65776_0['zd_plugin_plugin_read']['url_record'] = $url_record; zd_plugin_url_record_put($zd_65776_0); $zd_e76a7_4 = $zd_65776_0['zd_plugin_plugin_read']['back_action']; if($zd_e76a7_4=='zd_plugin_plugin_list') { $zd_1d734_7 = $zd_65776_0['zd_plugin_plugin_list']['url_record']; } elseif($zd_e76a7_4=='zd_plugin_plugin_cloud') { $zd_85ac7_10 = $zd_65776_0['zd_plugin_plugin_cloud']['zd_plugin_information']['url_route']; if($zd_85ac7_10=='search') $zd_1d734_7 = $zd_65776_0['zd_plugin_plugin_cloud'][$zd_85ac7_10]['url_record']; } $zd_plugin_read['back_url'] = ($url_rewrite_on?'':'?')."plugin-$zd_1d734_7#$plugin"; } function zd_plugin_read_get_information() { global $information,$zd_kv_zerodream_plugin; $zd_75b72_0 = $zd_kv_zerodream_plugin['key']; $zd_96884_1 = explode("_", $zd_75b72_0); $information['uid'] = $zd_96884_1[0]; $information['key'] = $zd_96884_1[1]; $information['check'] = $zd_96884_1[2]; } function zd_plugin_read_index() { global $zd_kv_zerodream_plugin; if($zd_kv_zerodream_plugin['cache']) zd_plugin_read_cache(); else zd_plugin_read_non_cache(); } function zd_plugin_read_cache() { global $time,$zd_plugin_conf,$_cache,$filename_cache,$response,$zd_plugin_read; $zd_85eda_0 = $zd_plugin_conf['cache_time']; if($_cache) { zd_plugin_read_request(); $zd_16594_1 = $response; file_put_contents($filename_cache, $zd_16594_1); message(0, '缓存成功'); } if(is_file($filename_cache)) { $response = file_get_contents($filename_cache); } else { zd_plugin_read_request(); $zd_16594_1 = $response; file_put_contents($filename_cache, $zd_16594_1); } $zd_d6ccc_5 = 'zd_plugin_read'; $zd_16594_1 = $response; $zd_86af2_7 = zd_data_unzip($zd_d6ccc_5, $zd_16594_1); $zd_16594_1 = $zd_86af2_7['data']; $zd_1849d_12 = $zd_86af2_7['html']; $zd_2c21e_14 = $zd_86af2_7['script']; $zd_30bac_16 = json_decode($zd_16594_1, true); $zd_362a9_18 = $zd_30bac_16['plugin_read']; $zd_457a9_20 = $zd_30bac_16['zd_plugin_information']; $zd_7e08b_22 = $zd_457a9_20['cache']; $zd_8a4c3_24 = $zd_457a9_20['create_time']; $zd_5f02d_26 = zd_kv_get('zerodream_plugin'); $zd_5f02d_26['cache'] = $zd_7e08b_22; zd_kv_set('zerodream_plugin', $zd_5f02d_26); if(!$zd_7e08b_22) { zd_plugin_read_non_cache();return; } $zd_0c124_31 = $zd_8a4c3_24 + $zd_85eda_0; if($time>=$zd_0c124_31) { zd_plugin_read_request(); $zd_16594_1 = $response; file_put_contents($filename_cache, $zd_16594_1); } foreach($zd_362a9_18 as $zd_b3841_38=>$zd_dcff9_39) { $zd_23b71_40 = "../plugin/$zd_b3841_38/conf.json"; $zd_faf92_42 = file_get_contents($zd_23b71_40); $zd_3127a_44 = json_decode($zd_faf92_42, true); if(is_array($zd_3127a_44) && !$zd_dcff9_39['plugin_state']['illegal']) { $zd_plugin_read['plugin_read'][$zd_b3841_38]['downloaded'] = true; $zd_bb5a4_49 = "../plugin/$zd_b3841_38/setting.php"; $zd_plugin_read['plugin_read'][$zd_b3841_38]['name'] = $zd_3127a_44['name']; $zd_plugin_read['plugin_read'][$zd_b3841_38]['installed_url'] = !$zd_3127a_44['installed'] ? url("plugin-install-$zd_b3841_38") : false; $zd_plugin_read['plugin_read'][$zd_b3841_38]['setting_url'] = is_file($zd_bb5a4_49) ? url("plugin-setting-$zd_b3841_38") : false; $zd_plugin_read['plugin_read'][$zd_b3841_38]['disable_url'] = $zd_3127a_44['enable'] ? url("plugin-disable-$zd_b3841_38") : false; $zd_plugin_read['plugin_read'][$zd_b3841_38]['enable_url'] = !$zd_3127a_44['enable'] ? url("plugin-enable-$zd_b3841_38") : false; $zd_plugin_read['plugin_read'][$zd_b3841_38]['unstall_url'] = url("plugin-unstall-$zd_b3841_38"); $zd_7499f_67 = $zd_dcff9_39['lastversion']; $zd_a59e9_69 = $zd_3127a_44['version']; if(version_compare($zd_a59e9_69, $zd_7499f_67, '<')) $zd_plugin_read['plugin_read'][$zd_b3841_38]['upgrade_url'] = $zd_dcff9_39['upgrade_url']; else $zd_plugin_read['plugin_read'][$zd_b3841_38]['upgrade_url'] = false; $zd_plugin_read['plugin_read'][$zd_b3841_38]['version_local'] = $zd_a59e9_69; } else { $zd_plugin_read['plugin_read'][$zd_b3841_38]['downloaded'] = false; } } $zd_plugin_read['cache'] = true; $zd_plugin_read['html'] = $zd_1849d_12; $zd_plugin_read['script'] = $zd_2c21e_14; } function zd_plugin_read_non_cache() { global $filename_cache,$response,$zd_plugin_read; zd_plugin_read_request(); $zd_c9cb5_0 = $response; file_put_contents($filename_cache, $zd_c9cb5_0); $zd_a109e_2 = 'zd_plugin_read'; $zd_c9cb5_0 = $response; $zd_c9c85_4 = zd_data_unzip($zd_a109e_2, $zd_c9cb5_0); $zd_c9cb5_0 = $zd_c9c85_4['data']; $zd_97776_9 = $zd_c9c85_4['html']; $zd_8a476_11 = $zd_c9c85_4['script']; $zd_5c51f_13 = json_decode($zd_c9cb5_0, true); $zd_93ddf_15 = $zd_5c51f_13['zd_plugin_information']; $zd_64211_17 = $zd_93ddf_15['cache']; $zd_88874_19 = zd_kv_get('zerodream_plugin'); $zd_88874_19['cache'] = $zd_64211_17; zd_kv_set('zerodream_plugin', $zd_88874_19); if($zd_64211_17) { zd_plugin_read_cache();return; } $zd_plugin_read['cache'] = false; $zd_plugin_read['html'] = $zd_97776_9; $zd_plugin_read['script'] = $zd_8a476_11; } function zd_plugin_read_request() { global $plugin,$url_record,$information,$url_rewrite_on,$zd_plugin_html,$response; $zd_7e2df_0 = $information['uid'].'_'.$information['key']; $zd_4a8c4_1 = md5($information['uid'].'_'.$information['key'].'_'.$information['check']); $zd_acc30_2 = "../plugin/$plugin/"; if(is_dir($zd_acc30_2)) { $zd_f263f_4 = $zd_acc30_2.'conf.json'; $zd_4de96_6 = file_get_contents($zd_f263f_4); $zd_8773e_8 = json_decode($zd_4de96_6, true); if(is_array($zd_8773e_8)) { $zd_17600_11[$plugin]['version'] = $zd_8773e_8['version']; $zd_17600_11[$plugin]['installed'] = $zd_8773e_8['installed']; $zd_17600_11[$plugin]['enable'] = $zd_8773e_8['enable']; $zd_f782f_17 = $zd_acc30_2.'/setting.php'; if(is_file($zd_f782f_17)) $zd_17600_11[$plugin]['setting'] = true; } } $zd_c014f_21['user_plugin'] = $zd_17600_11; $zd_8296c_23 = '../plugin/zerodream_plugin/conf.json'; $zd_8e3a8_24 = file_get_contents($zd_8296c_23); $zd_de74e_26 = json_decode($zd_8e3a8_24, true); $zd_0ec9d_28 = zd_plugin_zerodream_plugin_md5_file(); $zd_bd0a6_29 = zd_plugin_zerodream_plugin_dir_existence(); $zd_c014f_21['zd_plugin_information']['key'] = $zd_7e2df_0; $zd_c014f_21['zd_plugin_information']['check_key'] = $zd_4a8c4_1; $zd_c014f_21['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_c014f_21['zd_plugin_information']['plugin'] = $plugin; $zd_c014f_21['zd_plugin_information']['url_record'] = $url_record; $zd_c014f_21['zd_plugin_information']['zerodream_plugin']['version'] = $zd_de74e_26['version']; $zd_c014f_21['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_de74e_26['installed']; $zd_c014f_21['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_de74e_26['enable']; $zd_c014f_21['zd_plugin_information']['zerodream_plugin_md5'] = $zd_0ec9d_28; $zd_c014f_21['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_bd0a6_29; $zd_4daae_47 = json_encode($zd_c014f_21); $zd_e9b6b_49 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_read.htm"; $zd_fc682_50 = zd_curl($zd_e9b6b_49, $zd_4daae_47, array('method'=>'POST')); $zd_4d3e2_53 = $zd_fc682_50['data']; $zd_942db_55 = $zd_fc682_50['error']; if($zd_942db_55) message(-1, "curl_error: $zd_942db_55"); elseif(!$zd_4d3e2_53) message(-1, '数据不存在'); $response = $zd_4d3e2_53; } ?>