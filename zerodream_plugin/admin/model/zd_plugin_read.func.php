
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_read_dir() { $zd_969430 = '../data/zerodream_plugin/cache/zd_plugin_read/'; if(!is_dir($zd_969430)) mkdir($zd_969430); } function zd_plugin_read_data() { global $conf,$plugin,$url_rewrite_on,$url_record,$zd_kv_zerodream_plugin,$filename_cache; $zd_bbead0 = zd_request_uri(); $url_rewrite_on = $conf['url_rewrite_on']; $url_record = substr($zd_bbead0, $url_rewrite_on?14:15); $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); if(!isset($zd_kv_zerodream_plugin['key'])) message(-1, jump('请设置 key', url('plugin-setting-zerodream_plugin').'#key', 3)); $zd_7e6bd2 = md5($plugin); $filename_cache = "../data/zerodream_plugin/cache/zd_plugin_read/$zd_7e6bd2"; } function zd_plugin_read_url_record() { global $plugin,$url_rewrite_on,$url_record,$zd_plugin_read; $zd_7c31b0 = zd_plugin_url_record_get(); $zd_7c31b0['zd_plugin_information']['action'] = 'zd_plugin_plugin_read'; $zd_7c31b0['zd_plugin_plugin_read']['url_record'] = $url_record; zd_plugin_url_record_put($zd_7c31b0); $zd_877a14 = $zd_7c31b0['zd_plugin_plugin_read']['back_action']; if($zd_877a14=='zd_plugin_plugin_list') { $zd_a9f5c7 = $zd_7c31b0['zd_plugin_plugin_list']['url_record']; } elseif($zd_877a14=='zd_plugin_plugin_cloud') { $zd_459ca10 = $zd_7c31b0['zd_plugin_plugin_cloud']['zd_plugin_information']['url_route']; if($zd_459ca10=='search') $zd_a9f5c7 = $zd_7c31b0['zd_plugin_plugin_cloud'][$zd_459ca10]['url_record']; } $zd_plugin_read['back_url'] = ($url_rewrite_on?'':'?')."plugin-$zd_a9f5c7#$plugin"; } function zd_plugin_read_get_information() { global $information,$zd_kv_zerodream_plugin; $zd_0ed570 = $zd_kv_zerodream_plugin['key']; $zd_3b3a31 = explode("_", $zd_0ed570); $information['uid'] = $zd_3b3a31[0]; $information['key'] = $zd_3b3a31[1]; $information['check'] = $zd_3b3a31[2]; } function zd_plugin_read_index() { global $zd_kv_zerodream_plugin; if($zd_kv_zerodream_plugin['cache']) zd_plugin_read_cache(); else zd_plugin_read_non_cache(); } function zd_plugin_read_cache() { global $time,$zd_plugin_conf,$_cache,$filename_cache,$response,$zd_plugin_read; $zd_8a5b70 = $zd_plugin_conf['cache_time']; if($_cache) { zd_plugin_read_request(); $zd_4763f1 = $response; file_put_contents($filename_cache, $zd_4763f1); message(0, '缓存成功'); } if(is_file($filename_cache)) { $response = file_get_contents($filename_cache); } else { zd_plugin_read_request(); $zd_4763f1 = $response; file_put_contents($filename_cache, $zd_4763f1); } $zd_ea9d75 = 'zd_plugin_read'; $zd_4763f1 = $response; $zd_7b7f47 = zd_data_unzip($zd_ea9d75, $zd_4763f1); $zd_4763f1 = $zd_7b7f47['data']; $zd_6e8af12 = $zd_7b7f47['html']; $zd_40b4a14 = $zd_7b7f47['script']; $zd_f50ce16 = json_decode($zd_4763f1, true); $zd_1aebf18 = $zd_f50ce16['plugin_read']; $zd_25ece20 = $zd_f50ce16['zd_plugin_information']; $zd_e7b4c22 = $zd_25ece20['cache']; $zd_a140924 = $zd_25ece20['create_time']; $zd_9b30c26 = zd_kv_get('zerodream_plugin'); $zd_9b30c26['cache'] = $zd_e7b4c22; zd_kv_set('zerodream_plugin', $zd_9b30c26); if(!$zd_e7b4c22) { zd_plugin_read_non_cache();return; } $zd_4e6d131 = $zd_a140924 + $zd_8a5b70; if($time>=$zd_4e6d131) { zd_plugin_read_request(); $zd_4763f1 = $response; file_put_contents($filename_cache, $zd_4763f1); } foreach($zd_1aebf18 as $zd_18eac38=>$zd_d81fc39) { $zd_b69a740 = "../plugin/$zd_18eac38/conf.json"; $zd_843bb42 = file_get_contents($zd_b69a740); $zd_0494444 = json_decode($zd_843bb42, true); if(is_array($zd_0494444)) { $zd_plugin_read['plugin_read'][$zd_18eac38]['downloaded'] = true; $zd_b68c648 = "../plugin/$zd_18eac38/setting.php"; $zd_plugin_read['plugin_read'][$zd_18eac38]['name'] = $zd_0494444['name']; $zd_plugin_read['plugin_read'][$zd_18eac38]['installed_url'] = !$zd_0494444['installed'] ? url("plugin-install-$zd_18eac38") : false; $zd_plugin_read['plugin_read'][$zd_18eac38]['setting_url'] = is_file($zd_b68c648) ? url("plugin-setting-$zd_18eac38") : false; $zd_plugin_read['plugin_read'][$zd_18eac38]['disable_url'] = $zd_0494444['enable'] ? url("plugin-disable-$zd_18eac38") : false; $zd_plugin_read['plugin_read'][$zd_18eac38]['enable_url'] = !$zd_0494444['enable'] ? url("plugin-enable-$zd_18eac38") : false; $zd_plugin_read['plugin_read'][$zd_18eac38]['unstall_url'] = url("plugin-unstall-$zd_18eac38"); $zd_94dcd66 = $zd_d81fc39['lastversion']; $zd_1cadf68 = $zd_0494444['version']; if(version_compare($zd_1cadf68, $zd_94dcd66, '<')) $zd_plugin_read['plugin_read'][$zd_18eac38]['upgrade_url'] = $zd_d81fc39['upgrade_url']; else $zd_plugin_read['plugin_read'][$zd_18eac38]['upgrade_url'] = false; $zd_plugin_read['plugin_read'][$zd_18eac38]['version_local'] = $zd_1cadf68; } else { $zd_plugin_read['plugin_read'][$zd_18eac38]['downloaded'] = false; } } $zd_plugin_read['cache'] = true; $zd_plugin_read['html'] = $zd_6e8af12; $zd_plugin_read['script'] = $zd_40b4a14; } function zd_plugin_read_non_cache() { global $filename_cache,$response,$zd_plugin_read; zd_plugin_read_request(); $zd_160ed0 = $response; file_put_contents($filename_cache, $zd_160ed0); $zd_b02132 = 'zd_plugin_read'; $zd_160ed0 = $response; $zd_4468d4 = zd_data_unzip($zd_b02132, $zd_160ed0); $zd_160ed0 = $zd_4468d4['data']; $zd_f07219 = $zd_4468d4['html']; $zd_b28db11 = $zd_4468d4['script']; $zd_20b7d13 = json_decode($zd_160ed0, true); $zd_eaafe15 = $zd_20b7d13['zd_plugin_information']; $zd_2a9e617 = $zd_eaafe15['cache']; $zd_2060c19 = zd_kv_get('zerodream_plugin'); $zd_2060c19['cache'] = $zd_2a9e617; zd_kv_set('zerodream_plugin', $zd_2060c19); if($zd_2a9e617) { zd_plugin_read_cache();return; } $zd_plugin_read['cache'] = false; $zd_plugin_read['html'] = $zd_f07219; $zd_plugin_read['script'] = $zd_b28db11; } function zd_plugin_read_request() { global $plugin,$url_record,$information,$url_rewrite_on,$zd_plugin_html,$response; $zd_b774b0 = $information['uid'].'_'.$information['key']; $zd_a4d5a1 = "../plugin/$plugin/"; if(is_dir($zd_a4d5a1)) { $zd_0769c3 = $zd_a4d5a1.'conf.json'; $zd_d3c105 = file_get_contents($zd_0769c3); $zd_ace077 = json_decode($zd_d3c105, true); if(is_array($zd_ace077)) { $zd_492d210[$plugin]['version'] = $zd_ace077['version']; $zd_492d210[$plugin]['installed'] = $zd_ace077['installed']; $zd_492d210[$plugin]['enable'] = $zd_ace077['enable']; $zd_5896b16 = $zd_a4d5a1.'/setting.php'; if(is_file($zd_5896b16)) $zd_492d210[$plugin]['setting'] = true; } } $zd_3a64b20['user_plugin'] = $zd_492d210; $zd_8ac5a22 = '../plugin/zerodream_plugin/conf.json'; $zd_0710423 = file_get_contents($zd_8ac5a22); $zd_3402925 = json_decode($zd_0710423, true); $zd_0ec4127 = zd_plugin_zerodream_plugin_md5_file(); $zd_e5c4c28 = zd_plugin_zerodream_plugin_dir_existence(); $zd_3a64b20['zd_plugin_information']['key'] = $zd_b774b0; $zd_3a64b20['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_3a64b20['zd_plugin_information']['plugin'] = $plugin; $zd_3a64b20['zd_plugin_information']['url_record'] = $url_record; $zd_3a64b20['zd_plugin_information']['zerodream_plugin']['version'] = $zd_3402925['version']; $zd_3a64b20['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_3402925['installed']; $zd_3a64b20['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_3402925['enable']; $zd_3a64b20['zd_plugin_information']['zerodream_plugin_md5'] = $zd_0ec4127; $zd_3a64b20['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_e5c4c28; $zd_faf0844 = json_encode($zd_3a64b20); $zd_daa4e46 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_read.htm"; $zd_5d01447 = zd_curl($zd_daa4e46, $zd_faf0844, $zd_e7e6b50="POST"); $zd_4416c51 = $zd_5d01447['data']; $zd_aa39553 = $zd_5d01447['error']; if($zd_aa39553) message(-1, "curl_error: $zd_aa39553"); elseif(!$zd_4416c51) message(-1, '数据不存在'); $response = $zd_4416c51; } ?>