
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_read_dir() { $zd_6b5b1_0 = '../data/zerodream_plugin/cache/zd_plugin_read/'; if(!is_dir($zd_6b5b1_0)) mkdir($zd_6b5b1_0); } function zd_plugin_read_data() { global $conf,$plugin,$url_rewrite_on,$url_record,$zd_kv_zerodream_plugin,$filename_cache; $zd_4f031_0 = zd_request_uri(); $url_rewrite_on = $conf['url_rewrite_on']; $url_record = substr($zd_4f031_0, $url_rewrite_on?14:15); $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); if(!isset($zd_kv_zerodream_plugin['key'])) message(-1, jump('请设置 key', url('plugin-setting-zerodream_plugin').'#key', 3)); $zd_bed57_2 = md5($plugin); $filename_cache = "../data/zerodream_plugin/cache/zd_plugin_read/$zd_bed57_2"; } function zd_plugin_read_url_record() { global $plugin,$url_rewrite_on,$url_record,$zd_plugin_read; $zd_e6162_0 = zd_plugin_url_record_get(); $zd_e6162_0['zd_plugin_information']['action'] = 'zd_plugin_plugin_read'; $zd_e6162_0['zd_plugin_plugin_read']['url_record'] = $url_record; zd_plugin_url_record_put($zd_e6162_0); $zd_43b83_4 = $zd_e6162_0['zd_plugin_plugin_read']['back_action']; if($zd_43b83_4=='zd_plugin_plugin_list') { $zd_1cab7_7 = $zd_e6162_0['zd_plugin_plugin_list']['url_record']; } elseif($zd_43b83_4=='zd_plugin_plugin_cloud') { $zd_73452_10 = $zd_e6162_0['zd_plugin_plugin_cloud']['zd_plugin_information']['url_route']; if($zd_73452_10=='search') $zd_1cab7_7 = $zd_e6162_0['zd_plugin_plugin_cloud'][$zd_73452_10]['url_record']; } $zd_plugin_read['back_url'] = ($url_rewrite_on?'':'?')."plugin-$zd_1cab7_7#$plugin"; } function zd_plugin_read_get_information() { global $information,$zd_kv_zerodream_plugin; $zd_6e892_0 = $zd_kv_zerodream_plugin['key']; $zd_87b7b_1 = explode("_", $zd_6e892_0); $information['uid'] = $zd_87b7b_1[0]; $information['key'] = $zd_87b7b_1[1]; $information['check'] = $zd_87b7b_1[2]; } function zd_plugin_read_index() { global $zd_kv_zerodream_plugin; if($zd_kv_zerodream_plugin['cache']) zd_plugin_read_cache(); else zd_plugin_read_non_cache(); } function zd_plugin_read_cache() { global $time,$zd_plugin_conf,$_cache,$filename_cache,$response,$plugin_list_official,$zd_plugin_read; $zd_87a59_0 = $zd_plugin_conf['cache_time']; if($_cache) { zd_plugin_read_request(); $zd_4bca7_1 = $response; file_put_contents($filename_cache, $zd_4bca7_1); message(0, '缓存成功'); } if(is_file($filename_cache)) { $response = file_get_contents($filename_cache); } else { zd_plugin_read_request(); $zd_4bca7_1 = $response; file_put_contents($filename_cache, $zd_4bca7_1); } $zd_16ecf_5 = 'zd_plugin_read'; $zd_4bca7_1 = $response; $zd_04a6e_7 = zd_data_unzip($zd_16ecf_5, $zd_4bca7_1); $zd_4bca7_1 = $zd_04a6e_7['data']; $zd_30504_12 = $zd_04a6e_7['html']; $zd_f9ae8_14 = $zd_04a6e_7['script']; $zd_58ee5_16 = json_decode($zd_4bca7_1, true); $plugin_list_official = $zd_58ee5_16['plugin_list']; $zd_ec4a4_19 = $zd_58ee5_16['zd_plugin_information']; $zd_ed657_21 = $zd_ec4a4_19['cache']; $zd_e8e0a_23 = $zd_ec4a4_19['create_time']; $zd_db12f_25 = zd_kv_get('zerodream_plugin'); $zd_db12f_25['cache'] = $zd_ed657_21; zd_kv_set('zerodream_plugin', $zd_db12f_25); if(!$zd_ed657_21) {zd_plugin_read_non_cache();return;} $zd_b8bef_30 = $zd_e8e0a_23 + $zd_87a59_0; if($time>=$zd_b8bef_30) { zd_plugin_read_request(); $zd_4bca7_1 = $response; file_put_contents($filename_cache, $zd_4bca7_1); zd_plugin_read_cache();return; } zd_plugin_list_cache_data(); $zd_plugin_read['cache'] = true; $zd_plugin_read['html'] = $zd_30504_12; $zd_plugin_read['script'] = $zd_f9ae8_14; } function zd_plugin_read_non_cache() { global $filename_cache,$response,$zd_plugin_read; zd_plugin_read_request(); $zd_7022c_0 = $response; file_put_contents($filename_cache, $zd_7022c_0); $zd_87be6_2 = 'zd_plugin_read'; $zd_7022c_0 = $response; $zd_1d924_4 = zd_data_unzip($zd_87be6_2, $zd_7022c_0); $zd_7022c_0 = $zd_1d924_4['data']; $zd_a760b_9 = $zd_1d924_4['html']; $zd_ec3ad_11 = $zd_1d924_4['script']; $zd_4b1a7_13 = json_decode($zd_7022c_0, true); $zd_f656c_15 = $zd_4b1a7_13['zd_plugin_information']; $zd_7bd84_17 = $zd_f656c_15['cache']; $zd_54653_19 = zd_kv_get('zerodream_plugin'); $zd_54653_19['cache'] = $zd_7bd84_17; zd_kv_set('zerodream_plugin', $zd_54653_19); if($zd_7bd84_17) {zd_plugin_read_cache();return;} $zd_plugin_read['cache'] = false; $zd_plugin_read['html'] = $zd_a760b_9; $zd_plugin_read['script'] = $zd_ec3ad_11; } function zd_plugin_read_request() { global $plugin,$url_record,$information,$url_rewrite_on,$zd_plugin_html,$response; $zd_d3301_0 = $information['uid'].'_'.$information['key']; $zd_cfda5_1 = md5($information['uid'].'_'.$information['key'].'_'.$information['check']); $zd_7c5e4_2 = "../plugin/$plugin/"; if(is_dir($zd_7c5e4_2)) { $zd_19502_4 = $zd_7c5e4_2.'conf.json'; $zd_73efe_6 = file_get_contents($zd_19502_4); $zd_af2f0_8 = json_decode($zd_73efe_6, true); if(is_array($zd_af2f0_8)) { $zd_ba577_11[$plugin]['version'] = $zd_af2f0_8['version']; $zd_ba577_11[$plugin]['installed'] = $zd_af2f0_8['installed']; $zd_ba577_11[$plugin]['enable'] = $zd_af2f0_8['enable']; $zd_780bd_17 = $zd_7c5e4_2.'/setting.php'; if(is_file($zd_780bd_17)) $zd_ba577_11[$plugin]['setting'] = true; } } $zd_30f8a_21['user_plugins'] = $zd_ba577_11; $zd_4daa3_23 = '../plugin/zerodream_plugin/conf.json'; $zd_ff923_24 = file_get_contents($zd_4daa3_23); $zd_56fab_26 = json_decode($zd_ff923_24, true); $zd_e6610_28 = zd_plugin_zerodream_plugin_md5_file(); $zd_ac1dd_29 = zd_plugin_zerodream_plugin_dir_existence(); $zd_30f8a_21['zd_plugin_information']['key'] = $zd_d3301_0; $zd_30f8a_21['zd_plugin_information']['check_key'] = $zd_cfda5_1; $zd_30f8a_21['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_30f8a_21['zd_plugin_information']['plugin'] = $plugin; $zd_30f8a_21['zd_plugin_information']['url_record'] = $url_record; $zd_30f8a_21['zd_plugin_information']['zerodream_plugin']['version'] = $zd_56fab_26['version']; $zd_30f8a_21['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_56fab_26['installed']; $zd_30f8a_21['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_56fab_26['enable']; $zd_30f8a_21['zd_plugin_information']['zerodream_plugin_md5'] = $zd_e6610_28; $zd_30f8a_21['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_ac1dd_29; $zd_2428f_47 = json_encode($zd_30f8a_21); $zd_a860b_49 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_read.htm"; $zd_54d66_50 = zd_curl($zd_a860b_49, $zd_2428f_47, array('method'=>'POST')); $zd_6327d_53 = $zd_54d66_50['data']; $zd_75af6_55 = $zd_54d66_50['error']; if($zd_75af6_55) message(-1, "curl_error: $zd_75af6_55"); elseif(!$zd_6327d_53) message(-1, '数据不存在'); $response = $zd_6327d_53; } ?>