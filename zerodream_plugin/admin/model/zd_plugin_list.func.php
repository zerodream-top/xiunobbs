
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_list_dir() { $zd_8ab210 = '../data/zerodream_plugin/cache/zd_plugin_list/'; if(!is_dir($zd_8ab210)) mkdir($zd_8ab210); } function zd_plugin_list_data() { global $conf,$action,$orderby,$cateid,$page,$search,$url_rewrite_on,$url_record,$zd_kv_zerodream_plugin,$filename_cache; $zd_208ec0 = zd_request_uri(); $url_rewrite_on = $conf['url_rewrite_on']; $url_record = substr($zd_208ec0, $url_rewrite_on?14:15); $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); if(empty($zd_kv_zerodream_plugin['key'])) message(-1, jump('请设置 key', url('plugin-setting-zerodream_plugin').'#key', 3)); $zd_51b552 = md5($action.$orderby.$cateid.$page.$search); $filename_cache = "../data/zerodream_plugin/cache/zd_plugin_list/$zd_51b552"; } function zd_plugin_list_url_record() { global $url_record; $zd_ada7c0 = zd_plugin_url_record_get(); $zd_ada7c0['zd_plugin_information']['action'] = 'zd_plugin_list'; $zd_ada7c0['zd_plugin_plugin_list']['url_record'] = $url_record; $zd_ada7c0['zd_plugin_plugin_read']['back_action'] = 'zd_plugin_plugin_list'; zd_plugin_url_record_put($zd_ada7c0); } function zd_plugin_list_get_information() { global $information,$zd_kv_zerodream_plugin; $zd_d80640 = $zd_kv_zerodream_plugin['key']; $zd_773bc1 = explode("_", $zd_d80640); $information['uid'] = $zd_773bc1[0]; $information['key'] = $zd_773bc1[1]; $information['check'] = $zd_773bc1[2]; } function zd_plugin_list_index() { global $zd_kv_zerodream_plugin; if($zd_kv_zerodream_plugin['cache']) zd_plugin_list_cache(); else zd_plugin_list_non_cache(); } function zd_plugin_list_cache() { global $time,$zd_plugin_conf,$_cache,$filename_cache,$response,$zd_plugin_list; $zd_517b20 = $zd_plugin_conf['cache_time']; if($_cache) { zd_plugin_list_request(); $zd_7ba461 = $response; file_put_contents($filename_cache, $zd_7ba461); message(0, '缓存成功'); } if(is_file($filename_cache)) { $response = file_get_contents($filename_cache); } else { zd_plugin_list_request(); $zd_7ba461 = $response; file_put_contents($filename_cache, $zd_7ba461); } $zd_b48ca5 = 'zd_plugin_list'; $zd_7ba461 = $response; $zd_ef2fa7 = zd_data_unzip($zd_b48ca5, $zd_7ba461); $zd_7ba461 = $zd_ef2fa7['data']; $zd_ad04c12 = $zd_ef2fa7['html']; $zd_5623c14 = $zd_ef2fa7['script']; $zd_74c6816 = json_decode($zd_7ba461, true); $zd_ff07f18 = $zd_74c6816['plugin_list']; $zd_b1f0520 = $zd_74c6816['zd_plugin_information']; $zd_8067b22 = $zd_b1f0520['cache']; $zd_8b25f24 = $zd_b1f0520['create_time']; $zd_c1bf426 = zd_kv_get('zerodream_plugin'); $zd_c1bf426['cache'] = $zd_8067b22; zd_kv_set('zerodream_plugin', $zd_c1bf426); if(!$zd_8067b22) { zd_plugin_list_non_cache();return; } $zd_a280431 = $zd_8b25f24 + $zd_517b20; if($time>=$zd_a280431) { zd_plugin_list_request(); $zd_7ba461 = $response; file_put_contents($filename_cache, $zd_7ba461); } foreach($zd_ff07f18 as $zd_c446f38=>$zd_df49139) { $zd_d0c5c40 = "../plugin/$zd_c446f38/conf.json"; $zd_51e8b42 = file_get_contents($zd_d0c5c40); $zd_1ece344 = json_decode($zd_51e8b42, true); if(is_array($zd_1ece344)) { $zd_plugin_list['plugin_list'][$zd_c446f38]['downloaded'] = true; $zd_46ce348 = "../plugin/$zd_c446f38/setting.php"; $zd_plugin_list['plugin_list'][$zd_c446f38]['name'] = $zd_1ece344['name']; $zd_plugin_list['plugin_list'][$zd_c446f38]['installed_url'] = !$zd_1ece344['installed'] ? url("plugin-install-$zd_c446f38") : false; $zd_plugin_list['plugin_list'][$zd_c446f38]['setting_url'] = is_file($zd_46ce348) ? url("plugin-setting-$zd_c446f38") : false; $zd_plugin_list['plugin_list'][$zd_c446f38]['disable_url'] = $zd_1ece344['enable'] ? url("plugin-disable-$zd_c446f38") : false; $zd_plugin_list['plugin_list'][$zd_c446f38]['enable_url'] = !$zd_1ece344['enable'] ? url("plugin-enable-$zd_c446f38") : false; $zd_plugin_list['plugin_list'][$zd_c446f38]['unstall_url'] = url("plugin-unstall-$zd_c446f38"); $zd_ca9bb66 = $zd_df49139['lastversion']; $zd_7b74b68 = $zd_1ece344['version']; if(version_compare($zd_7b74b68, $zd_ca9bb66, '<')) $zd_plugin_list['plugin_list'][$zd_c446f38]['upgrade_url'] = $zd_df49139['upgrade_url']; else $zd_plugin_list['plugin_list'][$zd_c446f38]['upgrade_url'] = false; $zd_plugin_list['plugin_list'][$zd_c446f38]['version_local'] = $zd_7b74b68; } else { $zd_plugin_list['plugin_list'][$zd_c446f38]['downloaded'] = false; } } $zd_plugin_list['cache'] = true; $zd_plugin_list['html'] = $zd_ad04c12; $zd_plugin_list['script'] = $zd_5623c14; } function zd_plugin_list_non_cache() { global $filename_cache,$response,$zd_plugin_list; zd_plugin_list_request(); $zd_532a00 = $response; file_put_contents($filename_cache, $zd_532a00); $zd_1182b2 = 'zd_plugin_list'; $zd_532a00 = $response; $zd_0a5924 = zd_data_unzip($zd_1182b2, $zd_532a00); $zd_532a00 = $zd_0a5924['data']; $zd_565239 = $zd_0a5924['html']; $zd_789bf11 = $zd_0a5924['script']; $zd_c6fc113 = json_decode($zd_532a00, true); $zd_cb44215 = $zd_c6fc113['zd_plugin_information']; $zd_c7ae517 = $zd_cb44215['cache']; $zd_3bb1f19 = zd_kv_get('zerodream_plugin'); $zd_3bb1f19['cache'] = $zd_c7ae517; zd_kv_set('zerodream_plugin', $zd_3bb1f19); if($zd_c7ae517) { zd_plugin_list_cache();return; } $zd_plugin_list['cache'] = false; $zd_plugin_list['html'] = $zd_565239; $zd_plugin_list['script'] = $zd_789bf11; } function zd_plugin_list_request() { global $action,$orderby,$cateid,$page,$search,$url_record,$information,$url_rewrite_on,$response; $zd_b43af0 = $information['uid'].'_'.$information['key']; $zd_fffa21 = '../plugin/'; $zd_fe7392 = scandir($zd_fffa21); foreach($zd_fe7392 as $zd_0684a5=>$zd_bce386) { if($zd_bce386!='.' && $zd_bce386!='..') { $zd_5109c9 = $zd_fffa21.$zd_bce386.'/conf.json'; $zd_febbd12 = file_get_contents($zd_5109c9); $zd_3fd2b14 = json_decode($zd_febbd12, true); if(is_array($zd_3fd2b14)) { $zd_6b9b117 .= $zd_bce386.'|'; $zd_6b9b117 .= $zd_3fd2b14['version'].'|'; $zd_6b9b117 .= $zd_3fd2b14['installed']; $zd_6b9b117 .= $zd_3fd2b14['enable']; $zd_a3f5f25 = $zd_fffa21.$zd_bce386.'/setting.php'; if(is_file($zd_a3f5f25)) $zd_6b9b117 .= 1; $zd_6b9b117 .= ';'; } } } $zd_531de31 = 'zd_plugin_list'; $zd_0158232 = array('local_plugins'=>$zd_6b9b117); $zd_bacdd34 = zd_data_zip($zd_531de31, $zd_0158232); $zd_7991837 = '../plugin/zerodream_plugin/conf.json'; $zd_9f97d38 = file_get_contents($zd_7991837); $zd_72adf40 = json_decode($zd_9f97d38, true); $zd_b390c42 = zd_plugin_zerodream_plugin_md5_file(); $zd_d8b3a43 = zd_plugin_zerodream_plugin_dir_existence(); $zd_6f18644['zd_plugin_information']['key'] = $zd_b43af0; $zd_6f18644['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_6f18644['zd_plugin_information']['action'] = $action; $zd_6f18644['zd_plugin_information']['orderby'] = $orderby; $zd_6f18644['zd_plugin_information']['cateid'] = $cateid; $zd_6f18644['zd_plugin_information']['page'] = $page; $zd_6f18644['zd_plugin_information']['search'] = $search; $zd_6f18644['zd_plugin_information']['url_record'] = $url_record; $zd_6f18644['zd_plugin_information']['zerodream_plugin']['version'] = $zd_72adf40['version']; $zd_6f18644['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_72adf40['installed']; $zd_6f18644['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_72adf40['enable']; $zd_6f18644['zd_plugin_information']['zerodream_plugin_md5'] = $zd_b390c42; $zd_6f18644['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_d8b3a43; $zd_febbd12 = json_encode($zd_6f18644); $zd_0120b65 = $zd_febbd12.'__zd_plugin_list_explode__'.$zd_bacdd34; if($search) { $cateid = 0; $zd_9d15968 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_list.htm"; } else { $zd_9d15968 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_list-$action-$orderby-$cateid-$page.htm"; } $zd_0001070 = zd_curl($zd_9d15968, $zd_0120b65, $zd_3c26673="POST"); $zd_f97ba74 = $zd_0001070['data']; $zd_b36ab76 = $zd_0001070['error']; if($zd_b36ab76) message(-1, "curl_error: $zd_b36ab76"); elseif(!$zd_f97ba74) message(-1, '数据不存在'); $response = $zd_f97ba74; } ?>