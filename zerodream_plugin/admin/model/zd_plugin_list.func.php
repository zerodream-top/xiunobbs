
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_list_dir() { $zd_45d7e_0 = '../data/zerodream_plugin/cache/zd_plugin_list/'; if(!is_dir($zd_45d7e_0)) mkdir($zd_45d7e_0); } function zd_plugin_list_data() { global $conf,$action,$orderby,$cateid,$page,$search,$url_rewrite_on,$url_record,$zd_kv_zerodream_plugin,$filename_cache; $zd_cf0a3_0 = zd_request_uri(); $url_rewrite_on = $conf['url_rewrite_on']; $url_record = substr($zd_cf0a3_0, $url_rewrite_on?14:15); $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); if(empty($zd_kv_zerodream_plugin['key'])) message(-1, jump('请设置 key', url('plugin-setting-zerodream_plugin').'#key', 3)); $zd_6b1a5_2 = md5($action.$orderby.$cateid.$page.$search); $filename_cache = "../data/zerodream_plugin/cache/zd_plugin_list/$zd_6b1a5_2"; } function zd_plugin_list_url_record() { global $url_record; $zd_ac9b5_0 = zd_plugin_url_record_get(); $zd_ac9b5_0['zd_plugin_information']['action'] = 'zd_plugin_list'; $zd_ac9b5_0['zd_plugin_plugin_list']['url_record'] = $url_record; $zd_ac9b5_0['zd_plugin_plugin_read']['back_action'] = 'zd_plugin_plugin_list'; zd_plugin_url_record_put($zd_ac9b5_0); } function zd_plugin_list_get_information() { global $information,$zd_kv_zerodream_plugin; $zd_ec4c2_0 = $zd_kv_zerodream_plugin['key']; $zd_a0b7c_1 = explode("_", $zd_ec4c2_0); $information['uid'] = $zd_a0b7c_1[0]; $information['key'] = $zd_a0b7c_1[1]; $information['check'] = $zd_a0b7c_1[2]; } function zd_plugin_list_index() { global $zd_kv_zerodream_plugin; if($zd_kv_zerodream_plugin['cache']) zd_plugin_list_cache(); else zd_plugin_list_non_cache(); } function zd_plugin_list_cache() { global $time,$zd_plugin_conf,$_cache,$filename_cache,$response,$plugin_list_official,$zd_plugin_list; $zd_56594_0 = $zd_plugin_conf['cache_time']; if($_cache) { zd_plugin_list_request(); $zd_5d80b_1 = $response; file_put_contents($filename_cache, $zd_5d80b_1); message(0, '缓存成功'); } if(is_file($filename_cache)) { $response = file_get_contents($filename_cache); } else { zd_plugin_list_request(); $zd_5d80b_1 = $response; file_put_contents($filename_cache, $zd_5d80b_1); } $zd_82b9c_5 = 'zd_plugin_list'; $zd_5d80b_1 = $response; $zd_9ad95_7 = zd_data_unzip($zd_82b9c_5, $zd_5d80b_1); $zd_5d80b_1 = $zd_9ad95_7['data']; $zd_469be_12 = $zd_9ad95_7['html']; $zd_d7ec1_14 = $zd_9ad95_7['script']; $zd_d697d_16 = json_decode($zd_5d80b_1, true); $plugin_list_official = $zd_d697d_16['plugin_list']; $zd_caf61_19 = $zd_d697d_16['zd_plugin_information']; $zd_b9a0f_21 = $zd_caf61_19['cache']; $zd_8798f_23 = $zd_caf61_19['create_time']; $zd_70c28_25 = zd_kv_get('zerodream_plugin'); $zd_70c28_25['cache'] = $zd_b9a0f_21; zd_kv_set('zerodream_plugin', $zd_70c28_25); if(!$zd_b9a0f_21) {zd_plugin_list_non_cache();return;} $zd_ebb75_30 = $zd_8798f_23 + $zd_56594_0; if($time>=$zd_ebb75_30) { zd_plugin_list_request(); $zd_5d80b_1 = $response; file_put_contents($filename_cache, $zd_5d80b_1); zd_plugin_list_cache();return; } zd_plugin_list_cache_data(); $zd_plugin_list['cache'] = true; $zd_plugin_list['html'] = $zd_469be_12; $zd_plugin_list['script'] = $zd_d7ec1_14; } function zd_plugin_list_cache_data() { global $plugin_list_official,$zd_plugin_list; foreach($plugin_list_official as $zd_f1041_0=>$zd_0e6df_1) { $zd_43dd1_2 = "../plugin/$zd_f1041_0/conf.json"; $zd_03c89_4 = file_get_contents($zd_43dd1_2); $zd_289f3_6 = json_decode($zd_03c89_4, true); if(is_array($zd_289f3_6) && !$zd_0e6df_1['plugin_state']['illegal']) { $zd_65368_10 = "../plugin/$zd_f1041_0/setting.php"; $zd_plugin_list['plugin_list'][$zd_f1041_0]['downloaded'] = true; $zd_plugin_list['plugin_list'][$zd_f1041_0]['name'] = $zd_289f3_6['name']; $zd_plugin_list['plugin_list'][$zd_f1041_0]['installed_url'] = !$zd_289f3_6['installed'] ? url("plugin-install-$zd_f1041_0") : false; $zd_plugin_list['plugin_list'][$zd_f1041_0]['setting_url'] = is_file($zd_65368_10) ? url("plugin-setting-$zd_f1041_0") : false; $zd_plugin_list['plugin_list'][$zd_f1041_0]['disable_url'] = $zd_289f3_6['enable'] ? url("plugin-disable-$zd_f1041_0") : false; $zd_plugin_list['plugin_list'][$zd_f1041_0]['enable_url'] = !$zd_289f3_6['enable'] ? url("plugin-enable-$zd_f1041_0") : false; $zd_plugin_list['plugin_list'][$zd_f1041_0]['unstall_url'] = url("plugin-unstall-$zd_f1041_0"); $zd_937ff_29 = $zd_0e6df_1['lastversion']; $zd_c556e_31 = $zd_289f3_6['version']; if(version_compare($zd_c556e_31, $zd_937ff_29, '<')) { $zd_plugin_list['plugin_list'][$zd_f1041_0]['upgrade_url'] = $zd_0e6df_1['upgrade_url']; $zd_plugin_list['plugin_list'][$zd_f1041_0]['version_official'] = $zd_937ff_29; } else { $zd_plugin_list['plugin_list'][$zd_f1041_0]['upgrade_url'] = false; } $zd_plugin_list['plugin_list'][$zd_f1041_0]['version_local'] = $zd_c556e_31; } else { $zd_plugin_list['plugin_list'][$zd_f1041_0]['downloaded'] = false; } } } function zd_plugin_list_non_cache() { global $filename_cache,$response,$zd_plugin_list; zd_plugin_list_request(); $zd_83c59_0 = $response; file_put_contents($filename_cache, $zd_83c59_0); $zd_d746d_2 = 'zd_plugin_list'; $zd_83c59_0 = $response; $zd_6c8f5_4 = zd_data_unzip($zd_d746d_2, $zd_83c59_0); $zd_83c59_0 = $zd_6c8f5_4['data']; $zd_faec1_9 = $zd_6c8f5_4['html']; $zd_abec7_11 = $zd_6c8f5_4['script']; $zd_d2a56_13 = json_decode($zd_83c59_0, true); $zd_1901a_15 = $zd_d2a56_13['zd_plugin_information']; $zd_e9a41_17 = $zd_1901a_15['cache']; $zd_df44b_19 = zd_kv_get('zerodream_plugin'); $zd_df44b_19['cache'] = $zd_e9a41_17; zd_kv_set('zerodream_plugin', $zd_df44b_19); if($zd_e9a41_17) {zd_plugin_list_cache();return;} $zd_plugin_list['cache'] = false; $zd_plugin_list['html'] = $zd_faec1_9; $zd_plugin_list['script'] = $zd_abec7_11; } function zd_plugin_list_request() { global $action,$orderby,$cateid,$page,$search,$url_record,$information,$url_rewrite_on,$response; $zd_f186f_0 = $information['uid'].'_'.$information['key']; $zd_4ea0e_1 = md5($information['uid'].'_'.$information['key'].'_'.$information['check']); $zd_3d236_2 = '../plugin/'; $zd_56ba2_3 = scandir($zd_3d236_2); foreach($zd_56ba2_3 as $zd_ad9ca_6=>$zd_aef8d_7) { if($zd_aef8d_7!='.' && $zd_aef8d_7!='..') { $zd_c7d70_10 = $zd_3d236_2.$zd_aef8d_7.'/conf.json'; $zd_6c749_13 = file_get_contents($zd_c7d70_10); $zd_f1f14_15 = json_decode($zd_6c749_13, true); if(is_array($zd_f1f14_15)) { $zd_a2fc7_18 .= $zd_aef8d_7.'|'; $zd_a2fc7_18 .= $zd_f1f14_15['version'].'|'; $zd_a2fc7_18 .= $zd_f1f14_15['installed']; $zd_a2fc7_18 .= $zd_f1f14_15['enable']; $zd_32ada_26 = $zd_3d236_2.$zd_aef8d_7.'/setting.php'; if(is_file($zd_32ada_26)) $zd_a2fc7_18 .= 1; $zd_a2fc7_18 .= ';'; } } } $zd_341e7_32 = 'zd_plugin_list'; $zd_64a53_33 = array('local_plugins'=>$zd_a2fc7_18); $zd_55a33_35 = zd_data_zip($zd_341e7_32, $zd_64a53_33); $zd_b0d3b_38 = '../plugin/zerodream_plugin/conf.json'; $zd_89c38_39 = file_get_contents($zd_b0d3b_38); $zd_d437f_41 = json_decode($zd_89c38_39, true); $zd_25712_43 = zd_plugin_zerodream_plugin_md5_file(); $zd_9c445_44 = zd_plugin_zerodream_plugin_dir_existence(); $zd_2b4f3_45['zd_plugin_information']['key'] = $zd_f186f_0; $zd_2b4f3_45['zd_plugin_information']['check_key'] = $zd_4ea0e_1; $zd_2b4f3_45['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_2b4f3_45['zd_plugin_information']['action'] = $action; $zd_2b4f3_45['zd_plugin_information']['orderby'] = $orderby; $zd_2b4f3_45['zd_plugin_information']['cateid'] = $cateid; $zd_2b4f3_45['zd_plugin_information']['page'] = $page; $zd_2b4f3_45['zd_plugin_information']['search'] = $search; $zd_2b4f3_45['zd_plugin_information']['url_record'] = $url_record; $zd_2b4f3_45['zd_plugin_information']['zerodream_plugin']['version'] = $zd_d437f_41['version']; $zd_2b4f3_45['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_d437f_41['installed']; $zd_2b4f3_45['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_d437f_41['enable']; $zd_2b4f3_45['zd_plugin_information']['zerodream_plugin_md5'] = $zd_25712_43; $zd_2b4f3_45['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_9c445_44; $zd_6c749_13 = json_encode($zd_2b4f3_45); $zd_148f2_68 = $zd_6c749_13.'__zd_plugin_list_explode__'.$zd_55a33_35; if($search) { $cateid = 0; $zd_d2d52_71 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_list.htm"; } else { $zd_d2d52_71 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_list-$action-$orderby-$cateid-$page.htm"; } $zd_ea552_73 = zd_curl($zd_d2d52_71, $zd_148f2_68, array('method'=>'POST')); $zd_40f2c_76 = $zd_ea552_73['data']; $zd_346de_78 = $zd_ea552_73['error']; if($zd_346de_78) message(-1, "curl_error: $zd_346de_78"); elseif(!$zd_40f2c_76) message(-1, '数据不存在'); $response = $zd_40f2c_76; } ?>