
<?php

/*
    Powered by ZeroDream
    Optimized by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_list_dir() { $zd_5fcdc_0 = APP_PATH.'data/zerodream_plugin/cache/zd_plugin_list/'; if(!is_dir($zd_5fcdc_0)) mkdir($zd_5fcdc_0); } function zd_plugin_list_data() { global $conf,$zd_kv_zerodream_plugin,$action,$orderby,$cateid,$page,$search,$url_rewrite_on,$url_record,$filename_cache,$zd_plugin_list; if(empty($zd_kv_zerodream_plugin['key'])) message(-1, jump('请设置 key', url('_plugin-zerodream_plugin_setting-zerodream_plugin').'#key', 3)); $zd_217d4_0 = zd_request_uri(); $url_rewrite_on = $conf['url_rewrite_on']; $url_record = substr($zd_217d4_0, $url_rewrite_on?15:16); $zd_914b0_2 = md5($action.$orderby.$cateid.$page.$search); $filename_cache = APP_PATH."data/zerodream_plugin/cache/zd_plugin_list/$zd_914b0_2"; $zd_plugin_list = array(); } function zd_plugin_list_url_record() { global $url_record; $zd_08571_0 = zd_plugin_url_record_get(); $zd_08571_0['zd_plugin_information']['source'] = 'zerodream_plugin'; $zd_08571_0['zd_plugin_information']['action'] = 'zd_plugin_plugin_list'; $zd_08571_0['zd_plugin_plugin_list']['url_record'] = $url_record; $zd_08571_0['zd_plugin_plugin_read']['back_action'] = 'zd_plugin_plugin_list'; zd_plugin_url_record_put($zd_08571_0); } function zd_plugin_list_get_information() { global $information,$zd_kv_zerodream_plugin; $zd_b3fcb_0 = $zd_kv_zerodream_plugin['key']; $zd_0166d_1 = explode("_", $zd_b3fcb_0); $information['uid'] = $zd_0166d_1[0]; $information['key'] = $zd_0166d_1[1]; $information['check'] = $zd_0166d_1[2]; } function zd_plugin_list_index() { global $zd_kv_zerodream_plugin; $zd_e3ca4_0 = $zd_kv_zerodream_plugin['_zd_plugin_data']; $zd_7f219_1 = $zd_e3ca4_0['zd_plugin_cache']; if($zd_7f219_1['is_cache']) zd_plugin_list_cache(); else zd_plugin_list_non_cache(); } function zd_plugin_list_cache() { global $time,$zd_kv_zerodream_plugin,$_cache,$filename_cache,$response,$plugin_list_official,$zd_plugin_list; if($_cache) { zd_plugin_list_request(); $zd_a5164_0 = $response; file_put_contents($filename_cache, $zd_a5164_0); message(0, '缓存成功'); } if(is_file($filename_cache)) { $response = file_get_contents($filename_cache); } else { zd_plugin_list_request(); $zd_a5164_0 = $response; file_put_contents($filename_cache, $zd_a5164_0); } $zd_9c459_4 = 'zd_plugin_list'; $zd_a5164_0 = $response; $zd_ec85a_6 = zd_data_unzip($zd_9c459_4, $zd_a5164_0); if($zd_ec85a_6===false) { $zd_plugin_list['state'] = 'data'; $zd_plugin_list['data'] = $zd_a5164_0; } else { $zd_a5164_0 = $zd_ec85a_6['data']; $zd_c4bbb_13 = $zd_ec85a_6['html']; $zd_48649_15 = $zd_ec85a_6['script']; $zd_f7d55_17 = json_decode($zd_a5164_0, true); $plugin_list_official = $zd_f7d55_17['plugin_list']; $zd_22302_20 = $zd_f7d55_17['zd_plugin_information']; $zd_1fa0e_22 = $zd_22302_20['create_time']; $zd_8591b_24 = $zd_22302_20['_zd_plugin_data']; $zd_f4504_26 = $zd_8591b_24['zd_plugin_cache']['is_cache']; $zd_16313_28 = $zd_kv_zerodream_plugin['_zd_plugin_data']['zd_plugin_cache']['cache_time']; $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); $zd_kv_zerodream_plugin['_zd_plugin_data'] = $zd_8591b_24; zd_kv_set('zerodream_plugin', $zd_kv_zerodream_plugin); if(!$zd_f4504_26) {zd_plugin_list_non_cache();return;} $zd_2508c_31 = $zd_1fa0e_22 + $zd_16313_28; if($time>=$zd_2508c_31) { zd_plugin_list_request(); $zd_a5164_0 = $response; file_put_contents($filename_cache, $zd_a5164_0); zd_plugin_list_cache();return; } zd_plugin_list_cache_data(); $zd_plugin_list['state'] = 'zd_data'; $zd_plugin_list['cache'] = true; $zd_plugin_list['html'] = $zd_c4bbb_13; $zd_plugin_list['script'] = $zd_48649_15; } } function zd_plugin_list_cache_data() { global $plugin_list_official,$zd_plugin_list; foreach($plugin_list_official as $zd_26119_0=>$zd_7785b_1) { $zd_6b1d0_2 = APP_PATH."plugin/$zd_26119_0/conf.json"; $zd_3052d_4 = file_get_contents($zd_6b1d0_2); $zd_6df68_6 = json_decode($zd_3052d_4, true); if(is_array($zd_6df68_6) && !$zd_7785b_1['plugin_state']['illegal']) { $zd_a8ec0_10 = APP_PATH."plugin/$zd_26119_0/setting.php"; $zd_plugin_list['plugin_list'][$zd_26119_0]['downloaded'] = true; $zd_plugin_list['plugin_list'][$zd_26119_0]['name'] = $zd_6df68_6['name']; $zd_plugin_list['plugin_list'][$zd_26119_0]['installed_url'] = !$zd_6df68_6['installed'] ? url("_plugin-zerodream_plugin_install-$zd_26119_0") : false; $zd_plugin_list['plugin_list'][$zd_26119_0]['setting_url'] = is_file($zd_a8ec0_10) ? url("_plugin-zerodream_plugin_setting-$zd_26119_0") : false; $zd_plugin_list['plugin_list'][$zd_26119_0]['disable_url'] = $zd_6df68_6['enable'] ? url("_plugin-zerodream_plugin_disable-$zd_26119_0") : false; $zd_plugin_list['plugin_list'][$zd_26119_0]['enable_url'] = !$zd_6df68_6['enable'] ? url("_plugin-zerodream_plugin_enable-$zd_26119_0") : false; $zd_plugin_list['plugin_list'][$zd_26119_0]['unstall_url'] = url("_plugin-zerodream_plugin_unstall-$zd_26119_0"); $zd_1711a_29 = $zd_7785b_1['lastversion']; $zd_ffbcd_31 = $zd_6df68_6['version']; if(version_compare($zd_ffbcd_31, $zd_1711a_29, '<')) { $zd_plugin_list['plugin_list'][$zd_26119_0]['upgrade_url'] = $zd_7785b_1['upgrade_url']; $zd_plugin_list['plugin_list'][$zd_26119_0]['version_official'] = $zd_1711a_29; } else { $zd_plugin_list['plugin_list'][$zd_26119_0]['upgrade_url'] = false; } $zd_plugin_list['plugin_list'][$zd_26119_0]['version_local'] = $zd_ffbcd_31; } else { $zd_plugin_list['plugin_list'][$zd_26119_0]['downloaded'] = false; } } } function zd_plugin_list_non_cache() { global $filename_cache,$response,$zd_plugin_list; zd_plugin_list_request(); $zd_48ae3_0 = $response; file_put_contents($filename_cache, $zd_48ae3_0); $zd_0e021_2 = 'zd_plugin_list'; $zd_48ae3_0 = $response; $zd_93958_4 = zd_data_unzip($zd_0e021_2, $zd_48ae3_0); if($zd_93958_4===false) { $zd_plugin_list['state'] = 'data'; $zd_plugin_list['data'] = $zd_48ae3_0; } else { $zd_48ae3_0 = $zd_93958_4['data']; $zd_b2c40_11 = $zd_93958_4['html']; $zd_ad275_13 = $zd_93958_4['script']; $zd_274fa_15 = json_decode($zd_48ae3_0, true); $zd_1cb13_17 = $zd_274fa_15['zd_plugin_information']; $zd_9c72b_19 = $zd_1cb13_17['_zd_plugin_data']; $zd_b71d8_21 = $zd_9c72b_19['zd_plugin_cache']['is_cache']; $zd_b32c7_23 = zd_kv_get('zerodream_plugin'); $zd_b32c7_23['_zd_plugin_data'] = $zd_9c72b_19; zd_kv_set('zerodream_plugin', $zd_b32c7_23); if($zd_b71d8_21) {zd_plugin_list_cache();return;} $zd_plugin_list['state'] = 'zd_data'; $zd_plugin_list['cache'] = false; $zd_plugin_list['html'] = $zd_b2c40_11; $zd_plugin_list['script'] = $zd_ad275_13; } } function zd_plugin_list_request() { global $zd_scheme_host,$action,$orderby,$cateid,$page,$search,$url_record,$information,$url_rewrite_on,$response; $zd_50087_0 = $information['uid'].'_'.$information['key']; $zd_3a1bb_1 = md5($information['uid'].'_'.$information['key'].'_'.$information['check']); $zd_829cf_2 = APP_PATH.'plugin/'; $zd_52e7e_3 = scandir($zd_829cf_2); $zd_e224e_5 = ''; foreach($zd_52e7e_3 as $zd_1d371_7=>$zd_d96c3_8) { if($zd_d96c3_8!='.' && $zd_d96c3_8!='..') { $zd_9ddfb_11 = $zd_829cf_2.$zd_d96c3_8.'/conf.json'; $zd_10e2b_14 = file_get_contents($zd_9ddfb_11); $zd_41792_16 = json_decode($zd_10e2b_14, true); if(is_array($zd_41792_16)) { $zd_e224e_5 .= $zd_d96c3_8.'|'; $zd_e224e_5 .= $zd_41792_16['version'].'|'; $zd_e224e_5 .= $zd_41792_16['installed']; $zd_e224e_5 .= $zd_41792_16['enable']; $zd_21561_27 = $zd_829cf_2.$zd_d96c3_8.'/setting.php'; if(is_file($zd_21561_27)) $zd_e224e_5 .= 1; $zd_e224e_5 .= ';'; } } } $zd_2f2f4_33 = 'zd_plugin_list'; $zd_25de6_34 = array('local_plugins'=>$zd_e224e_5); $zd_6e9df_36 = zd_data_zip($zd_2f2f4_33, $zd_25de6_34); $zd_1e46f_39 = APP_PATH.'plugin/zerodream_plugin/conf.json'; $zd_616a9_40 = file_get_contents($zd_1e46f_39); $zd_c202a_42 = json_decode($zd_616a9_40, true); $zd_f6cbe_44 = zd_plugin_zerodream_plugin_md5_file(); $zd_ff30f_45 = zd_plugin_zerodream_plugin_dir_existence(); $zd_54569_46['zd_plugin_information']['key'] = $zd_50087_0; $zd_54569_46['zd_plugin_information']['check_key'] = $zd_3a1bb_1; $zd_54569_46['zd_plugin_information']['zd_url'] = $zd_scheme_host; $zd_54569_46['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_54569_46['zd_plugin_information']['action'] = $action; $zd_54569_46['zd_plugin_information']['orderby'] = $orderby; $zd_54569_46['zd_plugin_information']['cateid'] = $cateid; $zd_54569_46['zd_plugin_information']['page'] = $page; $zd_54569_46['zd_plugin_information']['search'] = $search; $zd_54569_46['zd_plugin_information']['url_record'] = $url_record; $zd_54569_46['zd_plugin_information']['zerodream_plugin']['version'] = $zd_c202a_42['version']; $zd_54569_46['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_c202a_42['installed']; $zd_54569_46['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_c202a_42['enable']; $zd_54569_46['zd_plugin_information']['zerodream_plugin_md5'] = $zd_f6cbe_44; $zd_54569_46['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_ff30f_45; $zd_10e2b_14 = json_encode($zd_54569_46); $zd_aa120_70 = $zd_10e2b_14.'__zd_plugin_list_explode__'.$zd_6e9df_36; if($search) { $cateid = 0; $zd_0b283_73 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_list.htm"; } else { $zd_0b283_73 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_list-$action-$orderby-$cateid-$page.htm"; } $zd_7eda2_75 = zd_curl($zd_0b283_73, $zd_aa120_70, array('method'=>'POST')); $zd_6a7c1_78 = $zd_7eda2_75['data']; $zd_9b649_80 = $zd_7eda2_75['error']; if($zd_9b649_80) message(-1, "curl_error: $zd_9b649_80"); elseif(empty($zd_6a7c1_78)) message(-1, '数据不存在'); $response = $zd_6a7c1_78; } ?>