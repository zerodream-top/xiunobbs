
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_list_dir() { $zd_7bb7f_0 = '../data/zerodream_plugin/cache/zd_plugin_list/'; if(!is_dir($zd_7bb7f_0)) mkdir($zd_7bb7f_0); } function zd_plugin_list_data() { global $conf,$action,$orderby,$cateid,$page,$search,$url_rewrite_on,$url_record,$zd_kv_zerodream_plugin,$filename_cache; $zd_33f0f_0 = zd_request_uri(); $url_rewrite_on = $conf['url_rewrite_on']; $url_record = substr($zd_33f0f_0, $url_rewrite_on?14:15); $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); if(empty($zd_kv_zerodream_plugin['key'])) message(-1, jump('请设置 key', url('plugin-setting-zerodream_plugin').'#key', 3)); $zd_79e74_2 = md5($action.$orderby.$cateid.$page.$search); $filename_cache = "../data/zerodream_plugin/cache/zd_plugin_list/$zd_79e74_2"; } function zd_plugin_list_url_record() { global $url_record; $zd_284a8_0 = zd_plugin_url_record_get(); $zd_284a8_0['zd_plugin_information']['action'] = 'zd_plugin_list'; $zd_284a8_0['zd_plugin_plugin_list']['url_record'] = $url_record; $zd_284a8_0['zd_plugin_plugin_read']['back_action'] = 'zd_plugin_plugin_list'; zd_plugin_url_record_put($zd_284a8_0); } function zd_plugin_list_get_information() { global $information,$zd_kv_zerodream_plugin; $zd_8d5cc_0 = $zd_kv_zerodream_plugin['key']; $zd_fedc0_1 = explode("_", $zd_8d5cc_0); $information['uid'] = $zd_fedc0_1[0]; $information['key'] = $zd_fedc0_1[1]; $information['check'] = $zd_fedc0_1[2]; } function zd_plugin_list_index() { global $zd_kv_zerodream_plugin; if($zd_kv_zerodream_plugin['cache']) zd_plugin_list_cache(); else zd_plugin_list_non_cache(); } function zd_plugin_list_cache() { global $time,$zd_plugin_conf,$_cache,$filename_cache,$response,$zd_plugin_list; $zd_d4c49_0 = $zd_plugin_conf['cache_time']; if($_cache) { zd_plugin_list_request(); $zd_2b7ec_1 = $response; file_put_contents($filename_cache, $zd_2b7ec_1); message(0, '缓存成功'); } if(is_file($filename_cache)) { $response = file_get_contents($filename_cache); } else { zd_plugin_list_request(); $zd_2b7ec_1 = $response; file_put_contents($filename_cache, $zd_2b7ec_1); } $zd_60de4_5 = 'zd_plugin_list'; $zd_2b7ec_1 = $response; $zd_5e89f_7 = zd_data_unzip($zd_60de4_5, $zd_2b7ec_1); $zd_2b7ec_1 = $zd_5e89f_7['data']; $zd_c9c4a_12 = $zd_5e89f_7['html']; $zd_94509_14 = $zd_5e89f_7['script']; $zd_d0b44_16 = json_decode($zd_2b7ec_1, true); $zd_3de29_18 = $zd_d0b44_16['plugin_list']; $zd_7a706_20 = $zd_d0b44_16['zd_plugin_information']; $zd_30932_22 = $zd_7a706_20['cache']; $zd_12a8b_24 = $zd_7a706_20['create_time']; $zd_c9054_26 = zd_kv_get('zerodream_plugin'); $zd_c9054_26['cache'] = $zd_30932_22; zd_kv_set('zerodream_plugin', $zd_c9054_26); if(!$zd_30932_22) { zd_plugin_list_non_cache();return; } $zd_b32d9_31 = $zd_12a8b_24 + $zd_d4c49_0; if($time>=$zd_b32d9_31) { zd_plugin_list_request(); $zd_2b7ec_1 = $response; file_put_contents($filename_cache, $zd_2b7ec_1); } foreach($zd_3de29_18 as $zd_a2490_38=>$zd_a3fd3_39) { $zd_67b24_40 = "../plugin/$zd_a2490_38/conf.json"; $zd_5ce85_42 = file_get_contents($zd_67b24_40); $zd_10008_44 = json_decode($zd_5ce85_42, true); if(is_array($zd_10008_44) && !$zd_a3fd3_39['plugin_state']['illegal']) { $zd_plugin_list['plugin_list'][$zd_a2490_38]['downloaded'] = true; $zd_07e06_49 = "../plugin/$zd_a2490_38/setting.php"; $zd_plugin_list['plugin_list'][$zd_a2490_38]['name'] = $zd_10008_44['name']; $zd_plugin_list['plugin_list'][$zd_a2490_38]['installed_url'] = !$zd_10008_44['installed'] ? url("plugin-install-$zd_a2490_38") : false; $zd_plugin_list['plugin_list'][$zd_a2490_38]['setting_url'] = is_file($zd_07e06_49) ? url("plugin-setting-$zd_a2490_38") : false; $zd_plugin_list['plugin_list'][$zd_a2490_38]['disable_url'] = $zd_10008_44['enable'] ? url("plugin-disable-$zd_a2490_38") : false; $zd_plugin_list['plugin_list'][$zd_a2490_38]['enable_url'] = !$zd_10008_44['enable'] ? url("plugin-enable-$zd_a2490_38") : false; $zd_plugin_list['plugin_list'][$zd_a2490_38]['unstall_url'] = url("plugin-unstall-$zd_a2490_38"); $zd_0da19_67 = $zd_a3fd3_39['lastversion']; $zd_f0f8e_69 = $zd_10008_44['version']; if(version_compare($zd_f0f8e_69, $zd_0da19_67, '<')) $zd_plugin_list['plugin_list'][$zd_a2490_38]['upgrade_url'] = $zd_a3fd3_39['upgrade_url']; else $zd_plugin_list['plugin_list'][$zd_a2490_38]['upgrade_url'] = false; $zd_plugin_list['plugin_list'][$zd_a2490_38]['version_local'] = $zd_f0f8e_69; } else { $zd_plugin_list['plugin_list'][$zd_a2490_38]['downloaded'] = false; } } $zd_plugin_list['cache'] = true; $zd_plugin_list['html'] = $zd_c9c4a_12; $zd_plugin_list['script'] = $zd_94509_14; } function zd_plugin_list_non_cache() { global $filename_cache,$response,$zd_plugin_list; zd_plugin_list_request(); $zd_6a9b7_0 = $response; file_put_contents($filename_cache, $zd_6a9b7_0); $zd_46205_2 = 'zd_plugin_list'; $zd_6a9b7_0 = $response; $zd_60cba_4 = zd_data_unzip($zd_46205_2, $zd_6a9b7_0); $zd_6a9b7_0 = $zd_60cba_4['data']; $zd_bfbb1_9 = $zd_60cba_4['html']; $zd_a278a_11 = $zd_60cba_4['script']; $zd_9c9dc_13 = json_decode($zd_6a9b7_0, true); $zd_c518f_15 = $zd_9c9dc_13['zd_plugin_information']; $zd_2df02_17 = $zd_c518f_15['cache']; $zd_1f5c2_19 = zd_kv_get('zerodream_plugin'); $zd_1f5c2_19['cache'] = $zd_2df02_17; zd_kv_set('zerodream_plugin', $zd_1f5c2_19); if($zd_2df02_17) { zd_plugin_list_cache();return; } $zd_plugin_list['cache'] = false; $zd_plugin_list['html'] = $zd_bfbb1_9; $zd_plugin_list['script'] = $zd_a278a_11; } function zd_plugin_list_request() { global $action,$orderby,$cateid,$page,$search,$url_record,$information,$url_rewrite_on,$response; $zd_79ab2_0 = $information['uid'].'_'.$information['key']; $zd_1f2c5_1 = md5($information['uid'].'_'.$information['key'].'_'.$information['check']); $zd_c3b31_2 = '../plugin/'; $zd_63871_3 = scandir($zd_c3b31_2); foreach($zd_63871_3 as $zd_bec04_6=>$zd_9c148_7) { if($zd_9c148_7!='.' && $zd_9c148_7!='..') { $zd_991ac_10 = $zd_c3b31_2.$zd_9c148_7.'/conf.json'; $zd_c4b06_13 = file_get_contents($zd_991ac_10); $zd_28589_15 = json_decode($zd_c4b06_13, true); if(is_array($zd_28589_15)) { $zd_fc953_18 .= $zd_9c148_7.'|'; $zd_fc953_18 .= $zd_28589_15['version'].'|'; $zd_fc953_18 .= $zd_28589_15['installed']; $zd_fc953_18 .= $zd_28589_15['enable']; $zd_b234c_26 = $zd_c3b31_2.$zd_9c148_7.'/setting.php'; if(is_file($zd_b234c_26)) $zd_fc953_18 .= 1; $zd_fc953_18 .= ';'; } } } $zd_44f7d_32 = 'zd_plugin_list'; $zd_b5a9c_33 = array('local_plugins'=>$zd_fc953_18); $zd_2fb74_35 = zd_data_zip($zd_44f7d_32, $zd_b5a9c_33); $zd_a98c5_38 = '../plugin/zerodream_plugin/conf.json'; $zd_da00b_39 = file_get_contents($zd_a98c5_38); $zd_c3f96_41 = json_decode($zd_da00b_39, true); $zd_5f29b_43 = zd_plugin_zerodream_plugin_md5_file(); $zd_28971_44 = zd_plugin_zerodream_plugin_dir_existence(); $zd_5edb4_45['zd_plugin_information']['key'] = $zd_79ab2_0; $zd_5edb4_45['zd_plugin_information']['check_key'] = $zd_1f2c5_1; $zd_5edb4_45['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_5edb4_45['zd_plugin_information']['action'] = $action; $zd_5edb4_45['zd_plugin_information']['orderby'] = $orderby; $zd_5edb4_45['zd_plugin_information']['cateid'] = $cateid; $zd_5edb4_45['zd_plugin_information']['page'] = $page; $zd_5edb4_45['zd_plugin_information']['search'] = $search; $zd_5edb4_45['zd_plugin_information']['url_record'] = $url_record; $zd_5edb4_45['zd_plugin_information']['zerodream_plugin']['version'] = $zd_c3f96_41['version']; $zd_5edb4_45['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_c3f96_41['installed']; $zd_5edb4_45['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_c3f96_41['enable']; $zd_5edb4_45['zd_plugin_information']['zerodream_plugin_md5'] = $zd_5f29b_43; $zd_5edb4_45['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_28971_44; $zd_c4b06_13 = json_encode($zd_5edb4_45); $zd_b4232_68 = $zd_c4b06_13.'__zd_plugin_list_explode__'.$zd_2fb74_35; if($search) { $cateid = 0; $zd_d135e_71 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_list.htm"; } else { $zd_d135e_71 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_list-$action-$orderby-$cateid-$page.htm"; } $zd_f381b_73 = zd_curl($zd_d135e_71, $zd_b4232_68, array('method'=>'POST')); $zd_8096c_76 = $zd_f381b_73['data']; $zd_ceadc_78 = $zd_f381b_73['error']; if($zd_ceadc_78) message(-1, "curl_error: $zd_ceadc_78"); elseif(!$zd_8096c_76) message(-1, '数据不存在'); $response = $zd_8096c_76; } ?>