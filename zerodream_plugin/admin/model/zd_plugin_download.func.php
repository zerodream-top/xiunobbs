
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_download_data() { global $zd_plugin_download; $zd_plugin_download = array(); } function zd_plugin_download_get_information() { global $conf,$information,$url_rewrite_on; $zd_9adce_0 = zd_kv_get('zerodream_plugin'); $zd_64392_1 = explode("_", $zd_9adce_0['key']); $information['uid'] = $zd_64392_1[0]; $information['key'] = $zd_64392_1[1]; $information['check'] = $zd_64392_1[2]; $url_rewrite_on = $conf['url_rewrite_on']; } function zd_plugin_download_check_information() { global $_key,$_check_key,$check_salt,$plugin,$information; $zd_31cf3_0 = $information['uid'].'_'.$information['key']; $zd_829c8_1 = md5($information['check'].$check_salt.$plugin); if($zd_31cf3_0 != $_key) message(-1, 'error: b01_01'); if($zd_829c8_1 != $_check_key) message(-1, 'error: b01_02'); } function zd_plugin_download_request() { global $plugin,$information,$url_rewrite_on,$data_download,$zd_plugin_html,$response; $zd_9422c_0 = $information['uid'].'_'.$information['key']; $zd_4a505_1 = zd_uniqid(); $zd_64618_2 = md5($information['check'].$zd_4a505_1.$plugin); $zd_222e0_4 = "../data/zerodream_plugin/check/$zd_4a505_1.download"; $zd_7c655_6 = $zd_64618_2; file_put_contents($zd_222e0_4, $zd_7c655_6); $zd_7f1a6_10 = '../plugin/zerodream_plugin/conf.json'; $zd_eb2c6_11 = file_get_contents($zd_7f1a6_10); $zd_b88dc_13 = json_decode($zd_eb2c6_11, true); $zd_d2d37_15 = zd_plugin_zerodream_plugin_md5_file(); $zd_e3136_16 = zd_plugin_zerodream_plugin_dir_existence(); $zd_69f74_17['zd_plugin_information']['key'] = $zd_9422c_0; $zd_69f74_17['zd_plugin_information']['check_salt'] = $zd_4a505_1; $zd_69f74_17['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_69f74_17['zd_plugin_information']['zerodream_plugin']['version'] = $zd_b88dc_13['version']; $zd_69f74_17['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_b88dc_13['installed']; $zd_69f74_17['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_b88dc_13['enable']; $zd_69f74_17['zd_plugin_information']['zerodream_plugin_md5'] = $zd_d2d37_15; $zd_69f74_17['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_e3136_16; $zd_070ca_32 = json_encode($zd_69f74_17); $zd_6324a_34 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_download-$plugin.htm"; $zd_dd1bb_35 = zd_curl($zd_6324a_34, $zd_070ca_32, array('method'=>'POST')); $zd_6f26b_38 = $zd_dd1bb_35['data']; $zd_afefd_40 = $zd_dd1bb_35['error']; if($zd_afefd_40) message(-1, "curl_error: $zd_afefd_40"); elseif(empty($zd_6f26b_38)) message(-1, '数据不存在'); $response = $zd_6f26b_38; } function zd_plugin_download_index() { global $plugin,$url_rewrite_on,$response,$jump_url,$data_download,$zd_plugin_download; $zd_5d399_0 = 'zd_plugin_download'; $zd_2bd17_1 = $response; $zd_7884f_2 = zd_data_unzip($zd_5d399_0, $zd_2bd17_1); $zd_2bd17_1 = $zd_7884f_2['data']; $zd_9f7ea_7 = json_decode($zd_2bd17_1, true); $zd_0cf29_9 = $zd_9f7ea_7['type']; if($zd_0cf29_9=='html') { $zd_cee7c_12 = $zd_7884f_2['html']; $zd_e3e81_14 = $zd_7884f_2['script']; $zd_plugin_download['html'] = $zd_cee7c_12; $zd_plugin_download['script'] = $zd_e3e81_14; include _include(APP_PATH.'plugin/zerodream_plugin/admin/view/htm/zd_plugin_download.htm'); } elseif($zd_0cf29_9=='download') { $zd_cf121_19 = $zd_9f7ea_7['cache']; if($plugin=='zerodream_plugin') { $jump_url = url("plugin-install-$plugin"); } elseif($zd_cf121_19) { $zd_efec2_22 = zd_plugin_url_record_get(); $zd_bcd25_23 = $zd_efec2_22['zd_plugin_information']['action']; if($zd_bcd25_23=='zd_plugin_plugin_list') { $zd_af4a4_26 = $zd_efec2_22['zd_plugin_plugin_list']['url_record']; $jump_url = ($url_rewrite_on?'':'?')."plugin-$zd_af4a4_26#$plugin"; } elseif($zd_bcd25_23=='zd_plugin_plugin_cloud') { $zd_0539b_30 = $zd_efec2_22['zd_plugin_plugin_cloud']['zd_plugin_information']['url_route']; if($zd_0539b_30=='search') { $zd_af4a4_26 = $zd_efec2_22['zd_plugin_plugin_cloud'][$zd_0539b_30]['url_record']; $jump_url = ($url_rewrite_on?'':'?')."plugin-$zd_af4a4_26#$plugin"; } } elseif($zd_bcd25_23=='zd_plugin_plugin_read') { $zd_af4a4_26 = $zd_efec2_22['zd_plugin_plugin_read']['url_record']; $jump_url = ($url_rewrite_on?'':'?')."plugin-$zd_af4a4_26"; } } else { $jump_url = $zd_9f7ea_7['jump_url']; } $data_download = $zd_7884f_2['data_download']; zd_plugin_download_plugin(); } } function zd_plugin_download_plugin() { global $plugin,$jump_url,$data_download; $zd_84787_0 = "../plugin/$plugin"; if(is_dir($zd_84787_0)) zd_deldir($zd_84787_0); $zd_77776_3 = zd_uniqid(); $zd_91bf9_4 = "../data/zerodream_plugin/download/$zd_77776_3"; if(is_file($zd_91bf9_4)) unlink($zd_91bf9_4); file_put_contents($zd_91bf9_4, $data_download); $zd_fe5ac_9 = $zd_91bf9_4; $zd_34a54_11 = '../plugin/'; zd_unzip($zd_fe5ac_9, $zd_34a54_11); unlink($zd_91bf9_4); message(0, jump(lang('zd_plugin_download_successful'), $jump_url, 3)); } ?>