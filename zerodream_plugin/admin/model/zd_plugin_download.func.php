
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_download_get_information() { global $conf,$information,$url_rewrite_on; $zd_ea9880 = zd_kv_get('zerodream_plugin'); $zd_fb4aa1 = explode("_", $zd_ea9880['key']); $information['uid'] = $zd_fb4aa1[0]; $information['key'] = $zd_fb4aa1[1]; $information['check'] = $zd_fb4aa1[2]; $url_rewrite_on = $conf['url_rewrite_on']; } function zd_plugin_download_check_information() { global $_key,$_check_key,$check_salt,$plugin,$information; $zd_6ab360 = $information['uid'].'_'.$information['key']; $zd_f5d301 = md5($information['check'].$check_salt.$plugin); if($zd_6ab360 != $_key) message(-1, 'error: b01_01'); if($zd_f5d301 != $_check_key) message(-1, 'error: b01_02'); } function zd_plugin_download_request() { global $plugin,$information,$url_rewrite_on,$data_download,$zd_plugin_html,$response; $zd_7fb140 = $information['uid'].'_'.$information['key']; $zd_40ad61 = zd_uniqid(); $zd_b1f562 = md5($information['check'].$zd_40ad61.$plugin); $zd_804334 = "../data/zerodream_plugin/check/$zd_40ad61.download"; $zd_fe4a96 = $zd_b1f562; file_put_contents($zd_804334, $zd_fe4a96); $zd_5d91110 = '../plugin/zerodream_plugin/conf.json'; $zd_ff46111 = file_get_contents($zd_5d91110); $zd_b69b013 = json_decode($zd_ff46111, true); $zd_f91ed15 = zd_plugin_zerodream_plugin_md5_file(); $zd_42faa16 = zd_plugin_zerodream_plugin_dir_existence(); $zd_80fdf17['zd_plugin_information']['key'] = $zd_7fb140; $zd_80fdf17['zd_plugin_information']['check_salt'] = $zd_40ad61; $zd_80fdf17['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_80fdf17['zd_plugin_information']['zerodream_plugin']['version'] = $zd_b69b013['version']; $zd_80fdf17['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_b69b013['installed']; $zd_80fdf17['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_b69b013['enable']; $zd_80fdf17['zd_plugin_information']['zerodream_plugin_md5'] = $zd_f91ed15; $zd_80fdf17['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_42faa16; $zd_a999232 = json_encode($zd_80fdf17); $zd_73ee434 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_download-$plugin.htm"; $zd_214a535 = zd_curl($zd_73ee434, $zd_a999232, $zd_61fc938="POST"); $zd_45c3839 = $zd_214a535['data']; $zd_73f0041 = $zd_214a535['error']; if($zd_73f0041) message(-1, "curl_error: $zd_73f0041"); elseif(!$zd_45c3839) message(-1, '数据不存在'); $response = $zd_45c3839; } function zd_plugin_download_index() { global $plugin,$url_rewrite_on,$response,$jump_url,$data_download; $zd_4f5ac0 = 'zd_plugin_download'; $zd_1a8b71 = $response; $zd_006c82 = zd_data_unzip($zd_4f5ac0, $zd_1a8b71); $zd_1a8b71 = $zd_006c82['data']; $zd_735bb7 = json_decode($zd_1a8b71, true); $zd_e3e779 = $zd_735bb7['type']; if($zd_e3e779=='html') { $zd_ab38012 = $zd_006c82['html']; $zd_7eee914 = $zd_006c82['script']; $zd_8318316['html'] = $zd_ab38012; $zd_8318316['script'] = $zd_7eee914; include _include(APP_PATH.'plugin/zerodream_plugin/admin/view/htm/zd_plugin_download.htm'); } elseif($zd_e3e779=='download') { $zd_d695621 = $zd_735bb7['cache']; if($plugin=='zerodream_plugin') { $jump_url = url("plugin-install-$plugin"); } elseif($zd_d695621) { $zd_a6a1a24 = zd_plugin_url_record_get(); $zd_e147d25 = $zd_a6a1a24['zd_plugin_information']['action']; if($zd_e147d25=='zd_plugin_plugin_list') { $zd_6528628 = $zd_a6a1a24['zd_plugin_plugin_list']['url_record']; $jump_url = ($url_rewrite_on?'':'?')."plugin-$zd_6528628#$plugin"; } elseif($zd_e147d25=='zd_plugin_plugin_cloud') { $zd_1964132 = $zd_a6a1a24['zd_plugin_plugin_cloud']['zd_plugin_information']['url_route']; if($zd_1964132=='search') { $zd_6528628 = $zd_a6a1a24['zd_plugin_plugin_cloud'][$zd_1964132]['url_record']; $jump_url = ($url_rewrite_on?'':'?')."plugin-$zd_6528628#$plugin"; } } elseif($zd_e147d25=='zd_plugin_plugin_read') { $zd_6528628 = $zd_a6a1a24['zd_plugin_plugin_read']['url_record']; $jump_url = ($url_rewrite_on?'':'?')."plugin-$zd_6528628"; } } else { $jump_url = $zd_735bb7['jump_url']; } $data_download = $zd_006c82['data_download']; zd_plugin_download_plugin(); } } function zd_plugin_download_plugin() { global $plugin,$jump_url,$data_download; $zd_ca6730 = "../plugin/$plugin"; if(is_dir($zd_ca6730)) zd_deldir($zd_ca6730); $zd_70ce43 = zd_uniqid(); $zd_75ac54 = "../data/zerodream_plugin/download/$zd_70ce43"; if(is_file($zd_75ac54)) unlink($zd_75ac54); file_put_contents($zd_75ac54, $data_download); $zd_bccd39 = $zd_75ac54; $zd_5928611 = '../plugin/'; zd_unzip($zd_bccd39, $zd_5928611); unlink($zd_75ac54); message(0, jump(lang('zd_plugin_download_successful'), $jump_url, 3)); } ?>