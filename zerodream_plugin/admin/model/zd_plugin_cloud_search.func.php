
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_cloud_search_dir() { $zd_6a7c6_0 = '../data/zerodream_plugin/cache/zd_plugin_cloud/'; if(!is_dir($zd_6a7c6_0)) mkdir($zd_6a7c6_0); } function zd_plugin_cloud_search_data() { global $conf,$url_rewrite_on,$url_record,$url_request,$zd_kv_zerodream_plugin,$filename_cache,$zd_plugin_cloud_search; $zd_08120_0 = zd_request_uri(); $url_rewrite_on = $conf['url_rewrite_on']; $url_record = substr($zd_08120_0, $url_rewrite_on?14:15); $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); if(empty($zd_kv_zerodream_plugin['key'])) message(-1, jump('请设置 key', url('plugin-setting-zerodream_plugin').'#key', 3)); $zd_eee23_2 = md5($url_request); $filename_cache = "../data/zerodream_plugin/cache/zd_plugin_cloud/$zd_eee23_2"; $zd_plugin_cloud_search = array(); } function zd_plugin_cloud_search_url_record() { global $url_record; $zd_de6e6_0 = zd_plugin_url_record_get(); $zd_de6e6_0['zd_plugin_information']['action'] = 'zd_plugin_plugin_cloud'; $zd_de6e6_0['zd_plugin_plugin_cloud']['zd_plugin_information']['url_route'] = 'search'; $zd_de6e6_0['zd_plugin_plugin_cloud']['search']['url_record'] = $url_record; $zd_de6e6_0['zd_plugin_plugin_read']['back_action'] = 'zd_plugin_plugin_cloud'; zd_plugin_url_record_put($zd_de6e6_0); } function zd_plugin_cloud_search_get_information() { global $information,$zd_kv_zerodream_plugin; $zd_caf92_0 = $zd_kv_zerodream_plugin['key']; $zd_8387b_1 = explode("_", $zd_caf92_0); $information['uid'] = $zd_8387b_1[0]; $information['key'] = $zd_8387b_1[1]; $information['check'] = $zd_8387b_1[2]; } function zd_plugin_cloud_search_index() { global $zd_kv_zerodream_plugin; if($zd_kv_zerodream_plugin['cache']) zd_plugin_cloud_search_cache(); else zd_plugin_cloud_search_non_cache(); } function zd_plugin_cloud_search_cache() { global $time,$zd_plugin_conf,$_cache,$response,$filename_cache,$zd_plugin_cloud_search; $zd_bc3b6_0 = $zd_plugin_conf['cache_time']; if($_cache) { zd_plugin_cloud_search_request(); $zd_d997f_1 = $response; file_put_contents($filename_cache, $zd_d997f_1); message(0, '缓存成功'); } if(is_file($filename_cache)) { $response = file_get_contents($filename_cache); } else { zd_plugin_cloud_search_request(); $zd_d997f_1 = $response; file_put_contents($filename_cache, $zd_d997f_1); } $zd_3a7de_5 = 'zd_plugin_cloud'; $zd_d997f_1 = $response; $zd_e6785_7 = zd_data_unzip($zd_3a7de_5, $zd_d997f_1); $zd_d997f_1 = $zd_e6785_7['data']; $zd_1a897_12 = $zd_e6785_7['html']; $zd_dc286_14 = $zd_e6785_7['script']; $zd_0975c_16 = json_decode($zd_d997f_1, true); $zd_77d4b_18 = $zd_0975c_16['plugin_list']; $zd_4d304_20 = $zd_0975c_16['zd_plugin_information']; $zd_a91ff_22 = $zd_4d304_20['cache']; $zd_5810f_24 = $zd_4d304_20['create_time']; $zd_b5c5a_26 = zd_kv_get('zerodream_plugin'); $zd_b5c5a_26['cache'] = $zd_a91ff_22; zd_kv_set('zerodream_plugin', $zd_b5c5a_26); if(!$zd_a91ff_22) {zd_plugin_cloud_search_non_cache();return;} $zd_ef17b_31 = $zd_5810f_24 + $zd_bc3b6_0; if($time>=$zd_ef17b_31) { zd_plugin_cloud_search_request(); $zd_d997f_1 = $response; file_put_contents($filename_cache, $zd_d997f_1); zd_plugin_cloud_search_cache();return; } foreach($zd_77d4b_18 as $zd_7c682_38=>$zd_ce4ee_39) { $zd_b8df7_40 = "../plugin/$zd_7c682_38/conf.json"; $zd_54687_42 = file_get_contents($zd_b8df7_40); $zd_e158c_44 = json_decode($zd_54687_42, true); if(is_array($zd_e158c_44)) { $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['downloaded'] = true; $zd_76cc8_48 = "../plugin/$zd_7c682_38/setting.php"; $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['name'] = $zd_e158c_44['name']; $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['installed_url'] = !$zd_e158c_44['installed'] ? url("plugin-install-$zd_7c682_38") : false; $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['setting_url'] = is_file($zd_76cc8_48) ? url("plugin-setting-$zd_7c682_38") : false; $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['disable_url'] = $zd_e158c_44['enable'] ? url("plugin-disable-$zd_7c682_38") : false; $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['enable_url'] = !$zd_e158c_44['enable'] ? url("plugin-enable-$zd_7c682_38") : false; $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['unstall_url'] = url("plugin-unstall-$zd_7c682_38"); $zd_0ca92_66 = $zd_ce4ee_39['lastversion']; $zd_8262a_68 = $zd_e158c_44['version']; if(version_compare($zd_8262a_68, $zd_0ca92_66, '<')) { $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['upgrade_url'] = $zd_ce4ee_39['upgrade_url']; $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['version_official'] = $zd_0ca92_66; } else { $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['upgrade_url'] = false; } $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['version_local'] = $zd_8262a_68; } else { $zd_plugin_cloud_search['plugin_list'][$zd_7c682_38]['downloaded'] = false; } } $zd_plugin_cloud_search['cache'] = true; $zd_plugin_cloud_search['html'] = $zd_1a897_12; $zd_plugin_cloud_search['script'] = $zd_dc286_14; } function zd_plugin_cloud_search_non_cache() { global $filename_cache,$response,$zd_plugin_cloud_search; zd_plugin_cloud_search_request(); $zd_7cd0e_0 = $response; file_put_contents($filename_cache, $zd_7cd0e_0); $zd_12815_2 = 'zd_plugin_cloud'; $zd_7cd0e_0 = $response; $zd_9e26a_4 = zd_data_unzip($zd_12815_2, $zd_7cd0e_0); $zd_7cd0e_0 = $zd_9e26a_4['data']; $zd_1cfba_9 = $zd_9e26a_4['html']; $zd_ead72_11 = $zd_9e26a_4['script']; $zd_ca9b6_13 = json_decode($zd_7cd0e_0, true); $zd_0d879_15 = $zd_ca9b6_13['zd_plugin_information']; $zd_da1b3_17 = $zd_0d879_15['cache']; $zd_7f9ed_19 = zd_kv_get('zerodream_plugin'); $zd_7f9ed_19['cache'] = $zd_da1b3_17; zd_kv_set('zerodream_plugin', $zd_7f9ed_19); if($zd_da1b3_17) {zd_plugin_cloud_search_cache();return;} $zd_plugin_cloud_search['cache'] = false; $zd_plugin_cloud_search['html'] = $zd_1cfba_9; $zd_plugin_cloud_search['script'] = $zd_ead72_11; } function zd_plugin_cloud_search_request() { global $url_record,$information,$url_rewrite_on,$url_request,$zd_plugin_html,$response; $zd_f4bd2_0 = $information['uid'].'_'.$information['key']; $zd_80efc_1 = md5($information['uid'].'_'.$information['key'].'_'.$information['check']); $zd_491c6_2 = '../plugin/zerodream_plugin/conf.json'; $zd_ed1fc_3 = file_get_contents($zd_491c6_2); $zd_adc4f_5 = json_decode($zd_ed1fc_3, true); $zd_b1eaf_7 = zd_plugin_zerodream_plugin_md5_file(); $zd_2d6e2_8 = zd_plugin_zerodream_plugin_dir_existence(); $zd_7f189_9['zd_plugin_information']['key'] = $zd_f4bd2_0; $zd_7f189_9['zd_plugin_information']['check_key'] = $zd_80efc_1; $zd_7f189_9['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_7f189_9['zd_plugin_information']['url_request'] = $url_request; $zd_7f189_9['zd_plugin_information']['url_record'] = $url_record; $zd_7f189_9['zd_plugin_information']['zerodream_plugin']['version'] = $zd_adc4f_5['version']; $zd_7f189_9['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_adc4f_5['installed']; $zd_7f189_9['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_adc4f_5['enable']; $zd_7f189_9['zd_plugin_information']['zerodream_plugin_md5'] = $zd_b1eaf_7; $zd_7f189_9['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_2d6e2_8; $zd_6cfca_26 = json_encode($zd_7f189_9); $zd_06024_28 = '../plugin/'; $zd_64037_29 = scandir($zd_06024_28); foreach ($zd_64037_29 as $zd_9a44c_32=>$zd_cd3ac_33) { if($zd_cd3ac_33!='.' && $zd_cd3ac_33!='..') { $zd_cae86_36 = $zd_06024_28.$zd_cd3ac_33.'/conf.json'; $zd_93ba8_39 = file_get_contents($zd_cae86_36); $zd_b2fd5_41 = json_decode($zd_93ba8_39, true); if(is_array($zd_b2fd5_41)) { $zd_56ec1_44 .= $zd_cd3ac_33.'|'; $zd_56ec1_44 .= $zd_b2fd5_41['version'].'|'; $zd_56ec1_44 .= $zd_b2fd5_41['installed']; $zd_56ec1_44 .= $zd_b2fd5_41['enable']; $zd_e8c80_52 = $zd_06024_28.$zd_cd3ac_33.'/setting.php'; if(is_file($zd_e8c80_52)) $zd_56ec1_44 .= 1; $zd_56ec1_44 .= ';'; } } } $zd_1575c_58 = 'zd_plugin_cloud'; $zd_95979_59 = array('data'=>$zd_6cfca_26, 'local_plugins'=>$zd_56ec1_44); $zd_b0275_62 = zd_data_zip($zd_1575c_58, $zd_95979_59); $zd_b3c50_65 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_cloud"; $zd_e5a1e_66 = zd_curl($zd_b3c50_65, $zd_b0275_62, array('method'=>'POST')); $zd_e77a0_69 = $zd_e5a1e_66['data']; $zd_1fe2d_71 = $zd_e5a1e_66['error']; if($zd_1fe2d_71) message(-1, "curl_error: $zd_1fe2d_71"); elseif(empty($zd_e77a0_69)) message(-1, '数据不存在'); $response = $zd_e77a0_69; } ?>