
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 function zd_plugin_cloud_search_dir() { $zd_0c4e00 = '../data/zerodream_plugin/cache/zd_plugin_cloud/'; if(!is_dir($zd_0c4e00)) mkdir($zd_0c4e00); } function zd_plugin_cloud_search_data() { global $conf,$url_rewrite_on,$url_record,$url_request,$zd_kv_zerodream_plugin,$filename_cache; $zd_0344c0 = zd_request_uri(); $url_rewrite_on = $conf['url_rewrite_on']; $url_record = substr($zd_0344c0, $url_rewrite_on?14:15); $zd_kv_zerodream_plugin = zd_kv_get('zerodream_plugin'); if(empty($zd_kv_zerodream_plugin['key'])) message(-1, jump('请设置 key', url('plugin-setting-zerodream_plugin').'#key', 3)); $zd_4e98a2 = md5($url_request); $filename_cache = "../data/zerodream_plugin/cache/zd_plugin_cloud/$zd_4e98a2"; } function zd_plugin_cloud_search_url_record() { global $url_record; $zd_698380 = zd_plugin_url_record_get(); $zd_698380['zd_plugin_information']['action'] = 'zd_plugin_plugin_cloud'; $zd_698380['zd_plugin_plugin_cloud']['zd_plugin_information']['url_route'] = 'search'; $zd_698380['zd_plugin_plugin_cloud']['search']['url_record'] = $url_record; $zd_698380['zd_plugin_plugin_read']['back_action'] = 'zd_plugin_plugin_cloud'; zd_plugin_url_record_put($zd_698380); } function zd_plugin_cloud_search_get_information() { global $information,$zd_kv_zerodream_plugin; $zd_89bbc0 = $zd_kv_zerodream_plugin['key']; $zd_ad4f71 = explode("_", $zd_89bbc0); $information['uid'] = $zd_ad4f71[0]; $information['key'] = $zd_ad4f71[1]; $information['check'] = $zd_ad4f71[2]; } function zd_plugin_cloud_search_index() { global $zd_kv_zerodream_plugin; if($zd_kv_zerodream_plugin['cache']) zd_plugin_cloud_search_cache(); else zd_plugin_cloud_search_non_cache(); } function zd_plugin_cloud_search_cache() { global $time,$zd_plugin_conf,$_cache,$response,$filename_cache,$zd_plugin_cloud_search; $zd_d32fc0 = $zd_plugin_conf['cache_time']; if($_cache) { zd_plugin_cloud_search_request(); $zd_41df01 = $response; file_put_contents($filename_cache, $zd_41df01); message(0, '缓存成功'); } if(is_file($filename_cache)) { $response = file_get_contents($filename_cache); } else { zd_plugin_cloud_search_request(); $zd_41df01 = $response; file_put_contents($filename_cache, $zd_41df01); } $zd_2236b5 = 'zd_plugin_cloud'; $zd_41df01 = $response; $zd_d1a497 = zd_data_unzip($zd_2236b5, $zd_41df01); $zd_41df01 = $zd_d1a497['data']; $zd_0386312 = $zd_d1a497['html']; $zd_c5bd314 = $zd_d1a497['script']; $zd_54fc016 = json_decode($zd_41df01, true); $zd_2386218 = $zd_54fc016['plugin_list']; $zd_9809420 = $zd_54fc016['zd_plugin_information']; $zd_e94d822 = $zd_9809420['cache']; $zd_7dd8724 = $zd_9809420['create_time']; $zd_8b7e226 = zd_kv_get('zerodream_plugin'); $zd_8b7e226['cache'] = $zd_e94d822; zd_kv_set('zerodream_plugin', $zd_8b7e226); if(!$zd_e94d822) { zd_plugin_cloud_search_non_cache();return; } $zd_eec5f31 = $zd_7dd8724 + $zd_d32fc0; if($time>=$zd_eec5f31) { zd_plugin_cloud_search_request(); $zd_41df01 = $response; file_put_contents($filename_cache, $zd_41df01); } foreach($zd_2386218 as $zd_f13fa38=>$zd_89f6b39) { $zd_7324740 = "../plugin/$zd_f13fa38/conf.json"; $zd_8b7a642 = file_get_contents($zd_7324740); $zd_41ad344 = json_decode($zd_8b7a642, true); if(is_array($zd_41ad344)) { $zd_plugin_cloud_search['plugin_list'][$zd_f13fa38]['downloaded'] = true; $zd_803bb48 = "../plugin/$zd_f13fa38/setting.php"; $zd_plugin_cloud_search['plugin_list'][$zd_f13fa38]['name'] = $zd_41ad344['name']; $zd_plugin_cloud_search['plugin_list'][$zd_f13fa38]['installed_url'] = !$zd_41ad344['installed'] ? url("plugin-install-$zd_f13fa38") : false; $zd_plugin_cloud_search['plugin_list'][$zd_f13fa38]['setting_url'] = is_file($zd_803bb48) ? url("plugin-setting-$zd_f13fa38") : false; $zd_plugin_cloud_search['plugin_list'][$zd_f13fa38]['disable_url'] = $zd_41ad344['enable'] ? url("plugin-disable-$zd_f13fa38") : false; $zd_plugin_cloud_search['plugin_list'][$zd_f13fa38]['enable_url'] = !$zd_41ad344['enable'] ? url("plugin-enable-$zd_f13fa38") : false; $zd_plugin_cloud_search['plugin_list'][$zd_f13fa38]['unstall_url'] = url("plugin-unstall-$zd_f13fa38"); $zd_0eab366 = $zd_89f6b39['lastversion']; $zd_42de868 = $zd_41ad344['version']; if(version_compare($zd_42de868, $zd_0eab366, '<')) $zd_plugin_cloud_search['plugin_list'][$zd_f13fa38]['upgrade_url'] = $zd_89f6b39['upgrade_url']; else $zd_plugin_cloud_search['plugin_list'][$zd_f13fa38]['upgrade_url'] = false; $zd_plugin_cloud_search['plugin_list'][$zd_f13fa38]['version_local'] = $zd_42de868; } else { $zd_plugin_cloud_search['plugin_list'][$zd_f13fa38]['downloaded'] = false; } } $zd_plugin_cloud_search['cache'] = true; $zd_plugin_cloud_search['html'] = $zd_0386312; $zd_plugin_cloud_search['script'] = $zd_c5bd314; } function zd_plugin_cloud_search_non_cache() { global $filename_cache,$response,$zd_plugin_cloud_search; zd_plugin_cloud_search_request(); $zd_719520 = $response; file_put_contents($filename_cache, $zd_719520); $zd_af6432 = 'zd_plugin_cloud'; $zd_719520 = $response; $zd_fc5ab4 = zd_data_unzip($zd_af6432, $zd_719520); $zd_719520 = $zd_fc5ab4['data']; $zd_6e4249 = $zd_fc5ab4['html']; $zd_5d9d211 = $zd_fc5ab4['script']; $zd_e610613 = json_decode($zd_719520, true); $zd_9a27815 = $zd_e610613['zd_plugin_information']; $zd_07b4217 = $zd_9a27815['cache']; $zd_5226119 = zd_kv_get('zerodream_plugin'); $zd_5226119['cache'] = $zd_07b4217; zd_kv_set('zerodream_plugin', $zd_5226119); if($zd_07b4217) { zd_plugin_cloud_search_cache();return; } $zd_plugin_cloud_search['cache'] = false; $zd_plugin_cloud_search['html'] = $zd_6e4249; $zd_plugin_cloud_search['script'] = $zd_5d9d211; } function zd_plugin_cloud_search_request() { global $url_record,$information,$url_rewrite_on,$url_request,$zd_plugin_html,$response; $zd_3baa00 = $information['uid'].'_'.$information['key']; $zd_7dd311 = '../plugin/zerodream_plugin/conf.json'; $zd_7b5842 = file_get_contents($zd_7dd311); $zd_8688e4 = json_decode($zd_7b5842, true); $zd_d70a86 = zd_plugin_zerodream_plugin_md5_file(); $zd_286b07 = zd_plugin_zerodream_plugin_dir_existence(); $zd_bcec08['zd_plugin_information']['key'] = $zd_3baa00; $zd_bcec08['zd_plugin_information']['url_rewrite_on'] = $url_rewrite_on; $zd_bcec08['zd_plugin_information']['url_request'] = $url_request; $zd_bcec08['zd_plugin_information']['url_record'] = $url_record; $zd_bcec08['zd_plugin_information']['zerodream_plugin']['version'] = $zd_8688e4['version']; $zd_bcec08['zd_plugin_information']['zerodream_plugin']['installed'] = $zd_8688e4['installed']; $zd_bcec08['zd_plugin_information']['zerodream_plugin']['enable'] = $zd_8688e4['enable']; $zd_bcec08['zd_plugin_information']['zerodream_plugin_md5'] = $zd_d70a86; $zd_bcec08['zd_plugin_information']['zerodream_plugin_dir_existence'] = $zd_286b07; $zd_93a1d23 = json_encode($zd_bcec08); $zd_27fa625 = '../plugin/'; $zd_92cc626 = scandir($zd_27fa625); foreach ($zd_92cc626 as $zd_3b05929=>$zd_5933830) { if($zd_5933830!='.' && $zd_5933830!='..') { $zd_1839b33 = $zd_27fa625.$zd_5933830.'/conf.json'; $zd_20dbe36 = file_get_contents($zd_1839b33); $zd_b1ebe38 = json_decode($zd_20dbe36, true); if(is_array($zd_b1ebe38)) { $zd_21af041 .= $zd_5933830.'|'; $zd_21af041 .= $zd_b1ebe38['version'].'|'; $zd_21af041 .= $zd_b1ebe38['installed']; $zd_21af041 .= $zd_b1ebe38['enable']; $zd_cf76549 = $zd_27fa625.$zd_5933830.'/setting.php'; if(is_file($zd_cf76549)) $zd_21af041 .= 1; $zd_21af041 .= ';'; } } } $zd_7f91155 = 'zd_plugin_cloud'; $zd_f018c56 = array('data'=>$zd_93a1d23, 'local_plugins'=>$zd_21af041); $zd_be3a659 = zd_data_zip($zd_7f91155, $zd_f018c56); $zd_7c70962 = ZERODREAM_URL.ZD_PLUGIN_URL_VERSION."plugin_cloud"; $zd_5334c63 = zd_curl($zd_7c70962, $zd_be3a659, $zd_1e1b666="POST"); $zd_0fdb967 = $zd_5334c63['data']; $zd_3cdac69 = $zd_5334c63['error']; if($zd_3cdac69) message(-1, "curl_error: $zd_3cdac69"); elseif(!$zd_0fdb967) message(-1, '数据不存在'); $response = $zd_0fdb967; } ?>