
<?php

/*
    Powered by ZeroDream
    Optimized by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 
// ~ 代码来自 xiuno，代码存在修改 ---> 开始
 function _xn_plugin_check_dependency($zd_9f2c7_0, $zd_b5e81_1 = 'install') { global $plugins; $zd_f7306_2 = $plugins[$zd_9f2c7_0]['name']; if($zd_b5e81_1 == 'install') { $zd_a93a7_5 = plugin_dependencies($zd_9f2c7_0); if(!empty($zd_a93a7_5)) { $zd_f9890_8 = plugin_dependency_arr_to_links($zd_a93a7_5); $zd_a8362_10 = lang('plugin_dependency_following', array('name'=>$zd_f7306_2, 's'=>$zd_f9890_8)); message(-1, $zd_a8362_10); } } else { $zd_a93a7_5 = plugin_by_dependencies($zd_9f2c7_0); if(!empty($zd_a93a7_5)) { $zd_f9890_8 = plugin_dependency_arr_to_links($zd_a93a7_5); $zd_a8362_10 = lang('plugin_being_dependent_cant_delete', array('name'=>$zd_f7306_2, 's'=>$zd_f9890_8)); message(-1, $zd_a8362_10); } } } function _xn_plugin_check_exists($zd_9c694_0, $zd_01764_1 = TRUE) { global $plugins, $official_plugins; !is_word($zd_9c694_0) AND message(-1, lang('plugin_name_error')); if($zd_01764_1) { !isset($plugins[$zd_9c694_0]) AND message(-1, lang('plugin_not_exists')); } else { !isset($official_plugins[$zd_9c694_0]) AND message(-1, lang('plugin_not_exists')); } } function _xn_plugin_lock_start() { global $route, $action; !xn_lock_start($route.'_'.$action) AND message(-1, lang('plugin_task_locked')); } function _xn_plugin_lock_end() { global $route, $action; xn_lock_end($route.'_'.$action); } 
// ~ 代码来自 xiuno，代码存在修改 ---> 结束
 function zd_plugin_url_record_put($zd_f5c00_0) { $zd_d61c1_1 = APP_PATH.'data/zerodream_plugin/url_record.php'; $zd_8f602_2 = json_encode($zd_f5c00_0); zd_file_php_json_put($zd_d61c1_1, $zd_8f602_2); zd_plugin_url_record_get($zd_a2921_6=array('type'=>'update','v'=>$zd_f5c00_0)); } function zd_plugin_url_record_get($zd_fbbf4_0=array()) { static $zd_a9eea_1 = array(); if(!empty($zd_fbbf4_0)) if($zd_fbbf4_0['type']=='update') $zd_a9eea_1 = $zd_fbbf4_0['v']; if(empty($zd_a9eea_1)) { $zd_62307_7 = APP_PATH.'data/zerodream_plugin/url_record.php'; $zd_753cf_8 = zd_file_php_json_get($zd_62307_7); $zd_a9eea_1 = json_decode($zd_753cf_8, true); } return $zd_a9eea_1; } function zd_plugin_zerodream_plugin_dir_existence() { if(!is_dir(APP_PATH.'data/')) return false; if(!is_dir(APP_PATH.'data/zerodream_plugin/')) return false; if(!is_dir(APP_PATH.'data/zerodream_plugin/cache/')) return false; if(!is_dir(APP_PATH.'data/zerodream_plugin/check/')) return false; if(!is_dir(APP_PATH.'data/zerodream_plugin/download/')) return false; if(!is_dir(APP_PATH.'data/zerodream_plugin/tmp/')) return false; else return true; } function zd_plugin_zerodream_plugin_md5_file() { $zd_916c6_0 = APP_PATH.'plugin/zerodream_plugin'; $zd_90803_1 = array($zd_916c6_0.'/conf.json'); $zd_2e4dc_3 = zd_md5_file($zd_916c6_0, $zd_90803_1); $zd_916c6_0 = $zd_916c6_0.'/conf.json'; $zd_07f64_8 = file_get_contents($zd_916c6_0); $zd_af107_10 = json_decode($zd_07f64_8, true); $zd_842c0_12 = array('installed', 'enable'); $zd_f985e_13 = ''; foreach($zd_af107_10 as $zd_ad6dd_15=>$zd_2a176_16) { if(!in_array($zd_ad6dd_15, $zd_842c0_12)) { if(is_array($zd_2a176_16)) $zd_2a176_16 = json_encode($zd_2a176_16); $zd_f985e_13 = md5($zd_f985e_13.$zd_2a176_16); } } $zd_a83a1_25 = md5($zd_2e4dc_3.$zd_f985e_13); return $zd_a83a1_25; } function _zd_plugin_read_by_dir($zd_b4290_29) { global $plugins; $zd_337b6_30 = $plugins[$zd_b4290_29]; if(empty($zd_337b6_30)) return array(); !isset($zd_337b6_30['name']) && $zd_337b6_30['name'] = ''; !isset($zd_337b6_30['brief']) && $zd_337b6_30['brief'] = ''; !isset($zd_337b6_30['version']) && $zd_337b6_30['version'] = '1.0'; !isset($zd_337b6_30['bbs_version']) && $zd_337b6_30['bbs_version'] = '4.0'; !isset($zd_337b6_30['installed']) && $zd_337b6_30['installed'] = 0; !isset($zd_337b6_30['enable']) && $zd_337b6_30['enable'] = 0; !isset($zd_337b6_30['hooks_rank']) && $zd_337b6_30['hooks_rank'] = array(); !isset($zd_337b6_30['overwrites_rank']) && $zd_337b6_30['overwrites_rank'] = array(); !isset($zd_337b6_30['dependencies']) && $zd_337b6_30['dependencies'] = array(); $zd_337b6_30['icon_url'] = ZERODREAM_URL._ZD_PLUGIN_ADMIN_PATH_PNG."$zd_b4290_29.zd_png"; $zd_337b6_30['setting_url'] = $zd_337b6_30['installed'] && is_file("../plugin/$zd_b4290_29/setting.php") ? url("_plugin-zerodream_plugin_setting-$zd_b4290_29") : ""; $zd_337b6_30['install_url'] = url("_plugin-zerodream_plugin_install-$zd_b4290_29"); $zd_337b6_30['disable_url'] = url("_plugin-zerodream_plugin_disable-$zd_b4290_29"); $zd_337b6_30['enable_url'] = url("_plugin-zerodream_plugin_enable-$zd_b4290_29"); $zd_337b6_30['unstall_url'] = url("_plugin-zerodream_plugin_unstall-$zd_b4290_29"); $zd_337b6_30['help_url'] = ''; if(!empty($zd_337b6_30['zd_tid'])) $zd_337b6_30['help_url'] = ZERODREAM_URL_THREAD."$zd_337b6_30[zd_tid].htm"; return $zd_337b6_30; } ?>