
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 define('DEFINED_ZERODREAM_FUNCTION', true); if(zd_index_path()) $include_path = ADMIN_PATH; else $include_path = APP_PATH; include _include($include_path.zd_index_path().'plugin/zerodream_plugin/model/zerodream_kv.func.php'); include _include($include_path.zd_index_path().'plugin/zerodream_plugin/model/zerodream_xiuno.func.php'); function zd_index_path() { if(defined('SKIP_ROUTE')) $zd_edf18_0 = '../'; return $zd_edf18_0; } function zd_url_rewrite() { global $conf; if(!$conf['url_rewrite_on']) $zd_b8ad9_0 = '?'; return $zd_b8ad9_0; } function zd_check_plugin($zd_1818e_0) { $zd_0dec5_1 = zd_index_path()."plugin/$zd_1818e_0/conf.json"; if(!is_file($zd_0dec5_1)) return false; $zd_54fef_4 = file_get_contents($zd_0dec5_1); $zd_84b1f_6 = json_decode($zd_54fef_4, true); if($zd_84b1f_6['installed'] && $zd_84b1f_6['enable']) $zd_fe186_10 = true; else $zd_fe186_10 = false; return $zd_fe186_10; } function zd_uniqid($zd_916d9_0='') { $zd_b97ab_1 = $zd_916d9_0.md5(uniqid(mt_rand(),true)); return $zd_b97ab_1; } function zd_curl($zd_aa201_0, $zd_f08ec_1=null, $zd_468a2_2=array()) { if(!isset($zd_468a2_2['method'])) $zd_468a2_2['method'] = 'GET'; $zd_bec92_5 = curl_init(); $zd_032b0_6 = array( CURLOPT_URL => $zd_aa201_0, CURLOPT_CUSTOMREQUEST => $zd_468a2_2['method'], CURLOPT_POSTFIELDS => $zd_f08ec_1, CURLOPT_RETURNTRANSFER => true, CURLOPT_SSL_VERIFYPEER => false, CURLOPT_SSL_VERIFYHOST => false, CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_0, CURLOPT_IPRESOLVE => CURL_IPRESOLVE_V4, CURLOPT_HTTPHEADER => array( "Expect: ", "Accept: application/json", "Content-Type: application/json; charset=utf-8", "Content-Length: ".strlen($zd_f08ec_1), ), ); curl_setopt_array($zd_bec92_5, $zd_032b0_6); $zd_b6150_13['data'] = curl_exec($zd_bec92_5); $zd_b6150_13['error'] = curl_error($zd_bec92_5); if(!empty($zd_468a2_2['getinfo'])) $zd_b6150_13['info'] = curl_getinfo($zd_bec92_5); curl_close($zd_bec92_5); return $zd_b6150_13; } function zd_request_uri() { if(isset($_SERVER['REQUEST_URI'])) $zd_f08f4_0 = $_SERVER['REQUEST_URI']; elseif(isset($_SERVER['argv'])) $zd_f08f4_0 = $_SERVER['PHP_SELF'].'?'.$_SERVER['argv'][0]; else $zd_f08f4_0 = $_SERVER['PHP_SELF'].'?'.$_SERVER['QUERY_STRING']; return $zd_f08f4_0; } function zd_remove_extension($zd_5e10a_0) { $zd_a5d16_1 = explode(".", $zd_5e10a_0); $zd_b33e0_3 = count($zd_a5d16_1); if($zd_b33e0_3 == 1) { $zd_8cbcd_6 = $zd_5e10a_0; } else { foreach($zd_a5d16_1 as $zd_04ecd_9=>$zd_1cad2_10) { if($zd_04ecd_9!=($zd_b33e0_3-1)) if($zd_8cbcd_6) $zd_8cbcd_6 .= '.'.$zd_1cad2_10; else $zd_8cbcd_6 = $zd_1cad2_10; } } return $zd_8cbcd_6; } function zd_deldir($zd_2930b_0) { $zd_2e463_1 = opendir($zd_2930b_0); while($zd_e4a97_3=readdir($zd_2e463_1)) { if($zd_e4a97_3!="." && $zd_e4a97_3!="..") { $zd_b9943_7 = $zd_2930b_0."/".$zd_e4a97_3; if(is_dir($zd_b9943_7)) zd_deldir($zd_b9943_7); else unlink($zd_b9943_7); } } closedir($zd_2e463_1); if(rmdir($zd_2930b_0)) return true; else return false; } function zd_md5_file($zd_12b0a_0, $zd_24bf6_1) { global $zd_md5_file; $zd_46c8c_2 = $zd_ad3f1_3.'zd_md5_file_zerodream_plugin.zip'; $zd_dc991_4 = $zd_12b0a_0; _zd_md5_file($zd_dc991_4, $zd_24bf6_1); $zd_49b5b_8 = $zd_md5_file['md5_file_zerodream_plugin']; unset($zd_md5_file); foreach($zd_49b5b_8 as $zd_8ee25_10=>$zd_bd2b4_11) $zd_f9f97_12 = md5($zd_f9f97_12.$zd_bd2b4_11); return $zd_f9f97_12; } function _zd_md5_file($zd_13c3f_0, $zd_efb6c_1) { global $zd_md5_file; $zd_27a5d_2 = scandir($zd_13c3f_0); foreach($zd_27a5d_2 as $zd_a6ac7_5=>$zd_53365_6) { if($zd_53365_6!="." && $zd_53365_6!="..") { $zd_0dfe5_9 = $zd_13c3f_0.'/'.$zd_53365_6; if(is_dir($zd_0dfe5_9)) { if(!in_array($zd_0dfe5_9, $zd_efb6c_1)) _zd_md5_file($zd_0dfe5_9, $zd_efb6c_1); } elseif(is_file($zd_0dfe5_9)) { if(!in_array($zd_0dfe5_9, $zd_efb6c_1)) $zd_md5_file['md5_file_zerodream_plugin'][] = md5_file($zd_0dfe5_9); } } } } function zd_data_zip($zd_d415c_0, $zd_e0fa2_1) { $zd_11f2b_2 = zd_index_path().'data/zerodream_plugin/tmp/zd_data_zip/'; if(!is_dir($zd_11f2b_2)) mkdir($zd_11f2b_2); $zd_56e9d_5 = $zd_d415c_0.'_'; $zd_f4e8d_7 = zd_uniqid($zd_56e9d_5); $zd_11f2b_2 = $zd_11f2b_2."$zd_f4e8d_7/"; if(!is_dir($zd_11f2b_2)) mkdir($zd_11f2b_2); $zd_cffa6_14 = $zd_11f2b_2."$zd_d415c_0/"; if(!is_dir($zd_cffa6_14)) mkdir($zd_cffa6_14); foreach($zd_e0fa2_1 as $zd_81098_20=>$zd_56de0_21) file_put_contents($zd_cffa6_14.$zd_81098_20, $zd_56de0_21); $zd_e3eee_25 = "$zd_11f2b_2/$zd_d415c_0.zip"; $zd_de870_28 = $zd_cffa6_14; zd_zip($zd_e3eee_25, $zd_de870_28); $zd_377a0_32 = $zd_e3eee_25; $zd_6cc5b_34 = file_get_contents($zd_377a0_32); zd_deldir($zd_11f2b_2); return $zd_6cc5b_34; } function zd_data_unzip($zd_d0937_0, $zd_a730d_1) { $zd_93cf9_2 = zd_index_path().'data/zerodream_plugin/tmp/zd_data_unzip/'; if(!is_dir($zd_93cf9_2)) mkdir($zd_93cf9_2); $zd_2c52b_5 = $zd_d0937_0.'_'; $zd_a6f29_7 = zd_uniqid($zd_2c52b_5); $zd_93cf9_2 = $zd_93cf9_2."$zd_a6f29_7/"; if(!is_dir($zd_93cf9_2)) mkdir($zd_93cf9_2); $zd_f826c_14 = $zd_93cf9_2.$zd_d0937_0.'.zip'; file_put_contents($zd_f826c_14, $zd_a730d_1); $zd_2bf3f_19 = $zd_f826c_14; $zd_0b4aa_21 = $zd_93cf9_2; zd_unzip($zd_2bf3f_19, $zd_0b4aa_21); $zd_1585a_25 = $zd_93cf9_2."$zd_d0937_0/"; $zd_c77db_28 = scandir($zd_1585a_25); foreach($zd_c77db_28 as $zd_e0b72_31=>$zd_5b67f_32) if($zd_5b67f_32!='.' && $zd_5b67f_32!='..') $zd_9dce7_35[$zd_5b67f_32] = file_get_contents($zd_1585a_25.$zd_5b67f_32); zd_deldir($zd_93cf9_2); return $zd_9dce7_35; } function zd_byte_conversion($zd_91109_0, $zd_0c957_1) { if($zd_91109_0>=1024**4) $zd_ee5d9_3 = round($zd_91109_0/1024**4, $zd_0c957_1).' T'; elseif($zd_91109_0>=1024**3) $zd_ee5d9_3 = round($zd_91109_0/1024**3, $zd_0c957_1).' G'; elseif($zd_91109_0>=1024**2) $zd_ee5d9_3 = round($zd_91109_0/1024**2, $zd_0c957_1).' M'; elseif($zd_91109_0>=1024**1) $zd_ee5d9_3 = round($zd_91109_0/1024**1, $zd_0c957_1).' K'; elseif($zd_91109_0>=1024**0) $zd_ee5d9_3 = round($zd_91109_0/1024**0, $zd_0c957_1).' B'; else return false; return $zd_ee5d9_3; } function zd_zip($zd_90ecf_0, $zd_5e360_1) { if(class_exists('ZipArchive')) { $zd_c9fe7_2 = pathinfo($zd_5e360_1); $zd_94e08_4 = $zd_c9fe7_2['dirname']; $zd_d3a53_6 = $zd_c9fe7_2['basename']; xn_unlink($zd_90ecf_0); $zd_aacc5_9 = new ZipArchive(); $zd_aacc5_9->open($zd_90ecf_0, ZIPARCHIVE::CREATE); $zd_aacc5_9->addEmptyDir($zd_d3a53_6); zd_dir_to_zip($zd_aacc5_9, $zd_5e360_1, strlen("$zd_94e08_4/")); $zd_aacc5_9->close(); } else { xn_unlink($zd_90ecf_0); include_once XIUNOPHP_PATH.'xn_zip_old.func.php'; xn_zip_old($zd_90ecf_0, $zd_5e360_1); } } function zd_dir_to_zip($zd_af4d4_0, $zd_741c3_1, $zd_140b1_2 = 0) { substr($zd_741c3_1, -1) != '/' AND $zd_741c3_1 .= '/'; $zd_1931a_5 = glob($zd_741c3_1."*"); foreach($zd_1931a_5 as $zd_c5dea_8) { $zd_2e32d_9 = substr($zd_c5dea_8, $zd_140b1_2); if(is_file($zd_c5dea_8)) { $zd_af4d4_0->addFile($zd_c5dea_8, $zd_2e32d_9); } elseif(is_dir($zd_c5dea_8)) { $zd_af4d4_0->addEmptyDir($zd_2e32d_9); zd_dir_to_zip($zd_af4d4_0, $zd_c5dea_8, $zd_140b1_2); } } } function zd_unzip($zd_f26a8_0, $zd_47cd7_1) { if(class_exists('ZipArchive')) { $zd_7c386_2 = new ZipArchive; if($zd_7c386_2->open($zd_f26a8_0) === TRUE) { $zd_7c386_2->extractTo($zd_47cd7_1); $zd_7c386_2->close(); } } else { include_once XIUNOPHP_PATH.'xn_zip_old.func.php'; xn_unzip_old($zd_f26a8_0, $zd_47cd7_1); } $zd_515d0_10 = substr(strrchr(substr($zd_47cd7_1, 0, -1), '/'), 1); $zd_da7a9_12 = substr(substr($zd_47cd7_1, 0, -1), 0, strpos($zd_47cd7_1, '/') + 1); if(is_dir($zd_47cd7_1.$zd_515d0_10)) { $zd_a4d29_17 = substr($zd_47cd7_1, 0, -1).'__xn__tmp__dir__/'; rename(substr($zd_47cd7_1, 0, -1), substr($zd_a4d29_17, 0, -1)); rename($zd_a4d29_17.$zd_515d0_10, substr($zd_47cd7_1, 0, -1)); } } ?>