
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 define('DEFINED_ZERODREAM_FUNCTION', true); if(zd_index_path()) $include_path = ADMIN_PATH; else $include_path = APP_PATH; include _include($include_path.zd_index_path().'plugin/zerodream_plugin/model/zerodream_kv.func.php'); include _include($include_path.zd_index_path().'plugin/zerodream_plugin/model/zerodream_xiuno.func.php'); function zd_index_path() { if(defined('SKIP_ROUTE')) $zd_86b18_0 = '../'; return $zd_86b18_0; } function zd_url_rewrite() { global $conf; if(!$conf['url_rewrite_on']) $zd_d0be6_0 = '?'; return $zd_d0be6_0; } function zd_check_plugin($zd_8f0f5_0) { $zd_f8c90_1 = zd_index_path()."plugin/$zd_8f0f5_0/conf.json"; if(!is_file($zd_f8c90_1)) return false; $zd_ed97a_4 = file_get_contents($zd_f8c90_1); $zd_84151_6 = json_decode($zd_ed97a_4, true); if($zd_84151_6['installed'] && $zd_84151_6['enable']) $zd_9a01b_10 = true; else $zd_9a01b_10 = false; return $zd_9a01b_10; } function zd_uniqid($zd_d63bb_0='') { $zd_d21fc_1 = $zd_d63bb_0.md5(uniqid(mt_rand(),true)); return $zd_d21fc_1; } function zd_curl($zd_b1dd4_0, $zd_0cae2_1=null, $zd_27b35_2=array()) { if(!isset($zd_27b35_2['method'])) $zd_27b35_2['method'] = 'GET'; $zd_e45be_5 = curl_init(); $zd_6b6e7_6 = array( CURLOPT_URL => $zd_b1dd4_0, CURLOPT_CUSTOMREQUEST => $zd_27b35_2['method'], CURLOPT_POSTFIELDS => $zd_0cae2_1, CURLOPT_RETURNTRANSFER => true, CURLOPT_SSL_VERIFYPEER => false, CURLOPT_SSL_VERIFYHOST => false, CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_0, CURLOPT_IPRESOLVE => CURL_IPRESOLVE_V4, CURLOPT_HTTPHEADER => array( "Expect: ", "Accept: application/json", "Content-Type: application/json; charset=utf-8", "Content-Length: ".strlen($zd_0cae2_1), ), ); curl_setopt_array($zd_e45be_5, $zd_6b6e7_6); $zd_74d0a_13['data'] = curl_exec($zd_e45be_5); $zd_74d0a_13['error'] = curl_error($zd_e45be_5); if(!empty($zd_27b35_2['getinfo'])) $zd_74d0a_13['info'] = curl_getinfo($zd_e45be_5); curl_close($zd_e45be_5); return $zd_74d0a_13; } function zd_request_uri() { if(isset($_SERVER['REQUEST_URI'])) $zd_f943e_0 = $_SERVER['REQUEST_URI']; elseif(isset($_SERVER['argv'])) $zd_f943e_0 = $_SERVER['PHP_SELF'].'?'.$_SERVER['argv'][0]; else $zd_f943e_0 = $_SERVER['PHP_SELF'].'?'.$_SERVER['QUERY_STRING']; return $zd_f943e_0; } function zd_remove_extension($zd_6f133_0) { $zd_aa0a4_1 = explode(".", $zd_6f133_0); $zd_cfde9_3 = count($zd_aa0a4_1); if($zd_cfde9_3 == 1) { $zd_72999_6 = $zd_6f133_0; } else { foreach($zd_aa0a4_1 as $zd_7a474_9=>$zd_ec820_10) { if($zd_7a474_9!=($zd_cfde9_3-1)) if($zd_72999_6) $zd_72999_6 .= '.'.$zd_ec820_10; else $zd_72999_6 = $zd_ec820_10; } } return $zd_72999_6; } function zd_deldir($zd_b2e15_0) { $zd_bed3a_1 = opendir($zd_b2e15_0); while($zd_1d1dd_3=readdir($zd_bed3a_1)) { if($zd_1d1dd_3!="." && $zd_1d1dd_3!="..") { $zd_673fa_7 = $zd_b2e15_0."/".$zd_1d1dd_3; if(is_dir($zd_673fa_7)) zd_deldir($zd_673fa_7); else unlink($zd_673fa_7); } } closedir($zd_bed3a_1); if(rmdir($zd_b2e15_0)) return true; else return false; } function zd_md5_file($zd_e2ea2_0, $zd_1497d_1) { global $zd_md5_file; $zd_68b22_2 = $zd_abb4a_3.'zd_md5_file_zerodream_plugin.zip'; $zd_edab2_4 = $zd_e2ea2_0; _zd_md5_file($zd_edab2_4, $zd_1497d_1); $zd_ffaeb_8 = $zd_md5_file['md5_file_zerodream_plugin']; unset($zd_md5_file); foreach($zd_ffaeb_8 as $zd_e7391_10=>$zd_a3d9c_11) $zd_1cd43_12 = md5($zd_1cd43_12.$zd_a3d9c_11); return $zd_1cd43_12; } function _zd_md5_file($zd_7337b_0, $zd_3dc95_1) { global $zd_md5_file; $zd_8e0f1_2 = scandir($zd_7337b_0); foreach($zd_8e0f1_2 as $zd_d9a9b_5=>$zd_39414_6) { if($zd_39414_6!="." && $zd_39414_6!="..") { $zd_a0372_9 = $zd_7337b_0.'/'.$zd_39414_6; if(is_dir($zd_a0372_9)) { if(!in_array($zd_a0372_9, $zd_3dc95_1)) _zd_md5_file($zd_a0372_9, $zd_3dc95_1); } elseif(is_file($zd_a0372_9)) { if(!in_array($zd_a0372_9, $zd_3dc95_1)) $zd_md5_file['md5_file_zerodream_plugin'][] = md5_file($zd_a0372_9); } } } } function zd_data_zip($zd_66583_0, $zd_4f42c_1) { // hook zd_data_zip_start.php $zd_4ee81_2 = zd_index_path().'data/zerodream_plugin/tmp/zd_data_zip/'; if(!is_dir($zd_4ee81_2)) mkdir($zd_4ee81_2); $zd_b5da4_5 = $zd_66583_0.'_'; $zd_0ba41_7 = zd_uniqid($zd_b5da4_5); $zd_4ee81_2 = $zd_4ee81_2."$zd_0ba41_7/"; if(!is_dir($zd_4ee81_2)) mkdir($zd_4ee81_2); $zd_016a5_14 = $zd_4ee81_2."$zd_66583_0/"; if(!is_dir($zd_016a5_14)) mkdir($zd_016a5_14); foreach($zd_4f42c_1 as $zd_e7ccf_20=>$zd_6eaac_21) file_put_contents($zd_016a5_14.$zd_e7ccf_20, $zd_6eaac_21); $zd_56685_25 = "$zd_4ee81_2/$zd_66583_0.zip"; $zd_381bf_28 = $zd_016a5_14; zd_zip($zd_56685_25, $zd_381bf_28); $zd_98bd5_32 = $zd_56685_25; $zd_f5952_34 = file_get_contents($zd_98bd5_32); zd_deldir($zd_4ee81_2); // hook zd_data_zip_end.php return $zd_f5952_34; } function zd_data_unzip($zd_3e9ff_0, $zd_b610f_1) { // hook zd_data_unzip_start.php $zd_a3afd_2 = zd_index_path().'data/zerodream_plugin/tmp/zd_data_unzip/'; if(!is_dir($zd_a3afd_2)) mkdir($zd_a3afd_2); $zd_14e65_5 = $zd_3e9ff_0.'_'; $zd_b9829_7 = zd_uniqid($zd_14e65_5); $zd_a3afd_2 = $zd_a3afd_2."$zd_b9829_7/"; if(!is_dir($zd_a3afd_2)) mkdir($zd_a3afd_2); $zd_e3367_14 = $zd_a3afd_2.$zd_3e9ff_0.'.zip'; file_put_contents($zd_e3367_14, $zd_b610f_1); $zd_4f779_19 = $zd_e3367_14; $zd_df0d1_21 = $zd_a3afd_2; zd_unzip($zd_4f779_19, $zd_df0d1_21); $zd_23a89_25 = $zd_a3afd_2."$zd_3e9ff_0/"; $zd_5e4fd_28 = scandir($zd_23a89_25); foreach($zd_5e4fd_28 as $zd_d014d_31=>$zd_b3d60_32) if($zd_b3d60_32!='.' && $zd_b3d60_32!='..') $zd_84966_35[$zd_b3d60_32] = file_get_contents($zd_23a89_25.$zd_b3d60_32); zd_deldir($zd_a3afd_2); // hook zd_data_unzip_end.php return $zd_84966_35; } function zd_byte_conversion($zd_0dc20_0, $zd_d4107_1) { if($zd_0dc20_0>=1024**4) $zd_0466a_3 = round($zd_0dc20_0/1024**4, $zd_d4107_1).' T'; elseif($zd_0dc20_0>=1024**3) $zd_0466a_3 = round($zd_0dc20_0/1024**3, $zd_d4107_1).' G'; elseif($zd_0dc20_0>=1024**2) $zd_0466a_3 = round($zd_0dc20_0/1024**2, $zd_d4107_1).' M'; elseif($zd_0dc20_0>=1024**1) $zd_0466a_3 = round($zd_0dc20_0/1024**1, $zd_d4107_1).' K'; elseif($zd_0dc20_0>=1024**0) $zd_0466a_3 = round($zd_0dc20_0/1024**0, $zd_d4107_1).' B'; else return false; return $zd_0466a_3; } function zd_zip($zd_9b65c_0, $zd_35627_1) { if(class_exists('ZipArchive')) { $zd_c2f6b_2 = pathinfo($zd_35627_1); $zd_9d78e_4 = $zd_c2f6b_2['dirname']; $zd_d5aa3_6 = $zd_c2f6b_2['basename']; xn_unlink($zd_9b65c_0); $zd_56187_9 = new ZipArchive(); $zd_56187_9->open($zd_9b65c_0, ZIPARCHIVE::CREATE); $zd_56187_9->addEmptyDir($zd_d5aa3_6); zd_dir_to_zip($zd_56187_9, $zd_35627_1, strlen("$zd_9d78e_4/")); $zd_56187_9->close(); } else { xn_unlink($zd_9b65c_0); include_once XIUNOPHP_PATH.'xn_zip_old.func.php'; xn_zip_old($zd_9b65c_0, $zd_35627_1); } } function zd_dir_to_zip($zd_877bc_0, $zd_03f22_1, $zd_14b31_2 = 0) { substr($zd_03f22_1, -1) != '/' AND $zd_03f22_1 .= '/'; $zd_6a27f_5 = glob($zd_03f22_1."*"); foreach($zd_6a27f_5 as $zd_ecb76_8) { $zd_2dc94_9 = substr($zd_ecb76_8, $zd_14b31_2); if(is_file($zd_ecb76_8)) { $zd_877bc_0->addFile($zd_ecb76_8, $zd_2dc94_9); } elseif(is_dir($zd_ecb76_8)) { $zd_877bc_0->addEmptyDir($zd_2dc94_9); zd_dir_to_zip($zd_877bc_0, $zd_ecb76_8, $zd_14b31_2); } } } function zd_unzip($zd_feac4_0, $zd_babb1_1) { if(class_exists('ZipArchive')) { $zd_6ad19_2 = new ZipArchive; if($zd_6ad19_2->open($zd_feac4_0) === TRUE) { $zd_6ad19_2->extractTo($zd_babb1_1); $zd_6ad19_2->close(); } } else { include_once XIUNOPHP_PATH.'xn_zip_old.func.php'; xn_unzip_old($zd_feac4_0, $zd_babb1_1); } $zd_3d968_10 = substr(strrchr(substr($zd_babb1_1, 0, -1), '/'), 1); $zd_98086_12 = substr(substr($zd_babb1_1, 0, -1), 0, strpos($zd_babb1_1, '/') + 1); if(is_dir($zd_babb1_1.$zd_3d968_10)) { $zd_b1166_17 = substr($zd_babb1_1, 0, -1).'__xn__tmp__dir__/'; rename(substr($zd_babb1_1, 0, -1), substr($zd_b1166_17, 0, -1)); rename($zd_b1166_17.$zd_3d968_10, substr($zd_babb1_1, 0, -1)); } } ?>