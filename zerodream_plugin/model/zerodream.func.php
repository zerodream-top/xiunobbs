
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 define('DEFINED_ZERODREAM_FUNCTION', true); if(zd_index_path()) $include_path = ADMIN_PATH; else $include_path = APP_PATH; include _include($include_path.zd_index_path().'plugin/zerodream_plugin/model/zerodream_kv.func.php'); include _include($include_path.zd_index_path().'plugin/zerodream_plugin/model/zerodream_xiuno.func.php'); function zd_index_path() { if(defined('SKIP_ROUTE')) $zd_c40a1_0 = '../'; return $zd_c40a1_0; } function zd_url_rewrite() { global $conf; if(!$conf['url_rewrite_on']) $zd_3c7aa_0 = '?'; return $zd_3c7aa_0; } function zd_check_plugin($plugin) { $zd_fcc26_0 = zd_index_path()."plugin/$plugin/conf.json"; if(!is_file($zd_fcc26_0)) return false; $zd_1ec33_2 = file_get_contents($zd_fcc26_0); $zd_53906_4 = json_decode($zd_1ec33_2, true); if($zd_53906_4['installed'] && $zd_53906_4['enable']) $zd_57d6c_8 = true; else $zd_57d6c_8 = false; return $zd_57d6c_8; } function zd_uniqid($prefix='') { $zd_ee023_0 = $prefix.md5(uniqid(mt_rand(),true)); return $zd_ee023_0; } function zd_curl($url, $data=null, $array=array()) { if(!isset($array['method'])) $array['method'] = 'GET'; $zd_3fdf3_0 = curl_init(); $zd_043ad_1 = array( CURLOPT_URL => $url, CURLOPT_CUSTOMREQUEST => $array['method'], CURLOPT_POSTFIELDS => $data, CURLOPT_RETURNTRANSFER => true, CURLOPT_SSL_VERIFYPEER => false, CURLOPT_SSL_VERIFYHOST => false, CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_0, CURLOPT_IPRESOLVE => CURL_IPRESOLVE_V4, CURLOPT_HTTPHEADER => array( "Expect: ", "Accept: application/json", "Content-Type: application/json; charset=utf-8", "Content-Length: ".strlen($data), ), ); curl_setopt_array($zd_3fdf3_0, $zd_043ad_1); $zd_3ef23_4['data'] = curl_exec($zd_3fdf3_0); $zd_3ef23_4['error'] = curl_error($zd_3fdf3_0); if(!empty($array['getinfo'])) $zd_3ef23_4['info'] = curl_getinfo($zd_3fdf3_0); curl_close($zd_3fdf3_0); return $zd_3ef23_4; } function zd_request_uri() { if(isset($_SERVER['REQUEST_URI'])) $zd_5e4dc_0 = $_SERVER['REQUEST_URI']; elseif(isset($_SERVER['argv'])) $zd_5e4dc_0 = $_SERVER['PHP_SELF'].'?'.$_SERVER['argv'][0]; else $zd_5e4dc_0 = $_SERVER['PHP_SELF'].'?'.$_SERVER['QUERY_STRING']; return $zd_5e4dc_0; } function zd_remove_extension($name_str) { $zd_4ffb1_0 = explode(".", $name_str); $zd_01fa6_1 = count($zd_4ffb1_0); if($zd_01fa6_1 == 1) { $zd_44312_4 = $name_str; } else { foreach($zd_4ffb1_0 as $zd_e536f_6=>$zd_081a9_7) { if($zd_e536f_6!=($zd_01fa6_1-1)) if($zd_44312_4) $zd_44312_4 .= '.'.$zd_081a9_7; else $zd_44312_4 = $zd_081a9_7; } } return $zd_44312_4; } function zd_deldir($path) { $zd_94512_0 = opendir($path); while($zd_73c84_1=readdir($zd_94512_0)) { if($zd_73c84_1!="." && $zd_73c84_1!="..") { $zd_43e55_5 = $path."/".$zd_73c84_1; if(is_dir($zd_43e55_5)) zd_deldir($zd_43e55_5); else unlink($zd_43e55_5); } } closedir($zd_94512_0); if(rmdir($path)) return true; else return false; } function zd_md5_file($filename, $exclude_filename) { global $zd_md5_file; $zd_0c1be_0 = $zd_2a528_1.'zd_md5_file_zerodream_plugin.zip'; $zd_31171_2 = $filename; _zd_md5_file($zd_31171_2, $exclude_filename); $zd_5b6fd_4 = $zd_md5_file['md5_file_zerodream_plugin']; unset($zd_md5_file); foreach($zd_5b6fd_4 as $zd_906b1_6=>$zd_92fdb_7) $zd_b1c4b_8 = md5($zd_b1c4b_8.$zd_92fdb_7); return $zd_b1c4b_8; } function _zd_md5_file($directory, $exclude_filename) { global $zd_md5_file; $zd_aaf66_0 = scandir($directory); foreach($zd_aaf66_0 as $zd_1fa1d_2=>$zd_289d0_3) { if($zd_289d0_3!="." && $zd_289d0_3!="..") { $zd_479e9_6 = $directory.'/'.$zd_289d0_3; if(is_dir($zd_479e9_6)) { if(!in_array($zd_479e9_6, $exclude_filename)) _zd_md5_file($zd_479e9_6, $exclude_filename); } elseif(is_file($zd_479e9_6)) { if(!in_array($zd_479e9_6, $exclude_filename)) $zd_md5_file['md5_file_zerodream_plugin'][] = md5_file($zd_479e9_6); } } } } function zd_data_zip($name, $data) { // hook zd_data_zip_start.php $zd_fd1bf_0 = zd_index_path().'data/zerodream_plugin/tmp/zd_data_zip/'; if(!is_dir($zd_fd1bf_0)) mkdir($zd_fd1bf_0); $zd_39bdb_3 = $name.'_'; $zd_d4632_4 = zd_uniqid($zd_39bdb_3); $zd_fd1bf_0 = $zd_fd1bf_0."$zd_d4632_4/"; if(!is_dir($zd_fd1bf_0)) mkdir($zd_fd1bf_0); $zd_d978d_11 = $zd_fd1bf_0."$name/"; if(!is_dir($zd_d978d_11)) mkdir($zd_d978d_11); foreach($data as $zd_fd0d9_15=>$zd_f1f0c_16) file_put_contents($zd_d978d_11.$zd_fd0d9_15, $zd_f1f0c_16); $zd_3ead6_20 = "$zd_fd1bf_0/$name.zip"; $zd_139a6_22 = $zd_d978d_11; zd_zip($zd_3ead6_20, $zd_139a6_22); $zd_d1178_26 = $zd_3ead6_20; $zd_1ace3_28 = file_get_contents($zd_d1178_26); zd_deldir($zd_fd1bf_0); // hook zd_data_zip_end.php return $zd_1ace3_28; } function zd_data_unzip($name, $data) { // hook zd_data_unzip_start.php $zd_da3cc_0 = zd_index_path().'data/zerodream_plugin/tmp/zd_data_unzip/'; if(!is_dir($zd_da3cc_0)) mkdir($zd_da3cc_0); $zd_1a3d3_3 = $name.'_'; $zd_b8bc3_4 = zd_uniqid($zd_1a3d3_3); $zd_da3cc_0 = $zd_da3cc_0."$zd_b8bc3_4/"; if(!is_dir($zd_da3cc_0)) mkdir($zd_da3cc_0); $zd_d05aa_11 = $zd_da3cc_0.$name.'.zip'; file_put_contents($zd_d05aa_11, $data); $zd_04ac1_14 = $zd_d05aa_11; $zd_c666f_16 = $zd_da3cc_0; zd_unzip($zd_04ac1_14, $zd_c666f_16); $zd_af1c8_20 = $zd_da3cc_0."$name/"; $zd_672f3_22 = scandir($zd_af1c8_20); foreach($zd_672f3_22 as $zd_38f8c_25=>$zd_8c8a7_26) if($zd_8c8a7_26!='.' && $zd_8c8a7_26!='..') $zd_9d3bd_29[$zd_8c8a7_26] = file_get_contents($zd_af1c8_20.$zd_8c8a7_26); zd_deldir($zd_da3cc_0); // hook zd_data_unzip_end.php return $zd_9d3bd_29; } function zd_byte_conversion($byte, $precision) { if($byte>=1024**4) $zd_5b45a_0 = round($byte/1024**4, $precision).' T'; elseif($byte>=1024**3) $zd_5b45a_0 = round($byte/1024**3, $precision).' G'; elseif($byte>=1024**2) $zd_5b45a_0 = round($byte/1024**2, $precision).' M'; elseif($byte>=1024**1) $zd_5b45a_0 = round($byte/1024**1, $precision).' K'; elseif($byte>=1024**0) $zd_5b45a_0 = round($byte/1024**0, $precision).' B'; else return false; return $zd_5b45a_0; } function zd_zip($zipfile, $extdir) { if(class_exists('ZipArchive')) { $zd_4be0e_0 = pathinfo($extdir); $zd_e4c4a_1 = $zd_4be0e_0['dirname']; $zd_7cc64_3 = $zd_4be0e_0['basename']; xn_unlink($zipfile); $zd_6c0ff_5 = new ZipArchive(); $zd_6c0ff_5->open($zipfile, ZIPARCHIVE::CREATE); $zd_6c0ff_5->addEmptyDir($zd_7cc64_3); zd_dir_to_zip($zd_6c0ff_5, $extdir, strlen("$zd_e4c4a_1/")); $zd_6c0ff_5->close(); } else { xn_unlink($zipfile); include_once XIUNOPHP_PATH.'xn_zip_old.func.php'; xn_zip_old($zipfile, $extdir); } } function zd_dir_to_zip($z, $zippath, $prelen = 0) { substr($zippath, -1) != '/' AND $zippath .= '/'; $zd_86cb0_0 = glob($zippath."*"); foreach($zd_86cb0_0 as $zd_d2db9_2) { $zd_5f97c_3 = substr($zd_d2db9_2, $prelen); if(is_file($zd_d2db9_2)) { $z->addFile($zd_d2db9_2, $zd_5f97c_3); } elseif(is_dir($zd_d2db9_2)) { $z->addEmptyDir($zd_5f97c_3); zd_dir_to_zip($z, $zd_d2db9_2, $prelen); } } } function zd_unzip($zipfile, $extdir) { if(class_exists('ZipArchive')) { $zd_bdcd9_0 = new ZipArchive; if($zd_bdcd9_0->open($zipfile) === TRUE) { $zd_bdcd9_0->extractTo($extdir); $zd_bdcd9_0->close(); } } else { include_once XIUNOPHP_PATH.'xn_zip_old.func.php'; xn_unzip_old($zipfile, $extdir); } $extdirlast = substr(strrchr(substr($extdir, 0, -1), '/'), 1); $extdirp = substr(substr($extdir, 0, -1), 0, strpos($extdir, '/') + 1); if(is_dir($extdir.$extdirlast)) { $extdirtmp = substr($extdir, 0, -1).'__xn__tmp__dir__/'; rename(substr($extdir, 0, -1), substr($extdirtmp, 0, -1)); rename($extdirtmp.$extdirlast, substr($extdir, 0, -1)); } } ?>