
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 define('DEFINED_ZERODREAM_FUNCTION', true); if(zd_index_path()) $dirname = ADMIN_PATH; else $dirname = APP_PATH; include _include($dirname.zd_index_path().'plugin/zerodream_plugin/model/zerodream_kv.func.php'); include _include($dirname.zd_index_path().'plugin/zerodream_plugin/model/zerodream_xiuno.func.php'); function zd_index_path() { if(defined('SKIP_ROUTE')) $zd_d25410 = '../'; return $zd_d25410; } function zd_url_rewrite() { global $conf; if(!$conf['url_rewrite_on']) $zd_1540e0 = '?'; return $zd_1540e0; } function zd_check_plugin($zd_16c430) { $zd_3f8f41 = zd_index_path()."plugin/$zd_16c430/conf.json"; if(!is_file($zd_3f8f41)) return false; $zd_375e74 = file_get_contents($zd_3f8f41); $zd_d3c3a6 = json_decode($zd_375e74, true); if($zd_d3c3a6['installed'] && $zd_d3c3a6['enable']) $zd_71db210 = true; else $zd_71db210 = false; return $zd_71db210; } function zd_uniqid($zd_5a5470='') { $zd_6e8be1 = $zd_5a5470.md5(uniqid(mt_rand(),true)); return $zd_6e8be1; } function zd_curl($zd_7a6000, $zd_397cb1, $zd_283a12="POST") { $zd_7f74a3 = curl_init(); $zd_c237b4 = array( CURLOPT_URL => $zd_7a6000, CURLOPT_CUSTOMREQUEST => $zd_283a12, CURLOPT_POSTFIELDS => $zd_397cb1, CURLOPT_RETURNTRANSFER => true, CURLOPT_SSL_VERIFYPEER => false, CURLOPT_SSL_VERIFYHOST => false, CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_0, CURLOPT_IPRESOLVE => CURL_IPRESOLVE_V4, CURLOPT_HTTPHEADER => array( "Expect: ", "Accept: application/json", "Content-Type: application/json; charset='utf-8'", ), ); curl_setopt_array($zd_7f74a3, $zd_c237b4); $zd_5e9d710['data'] = curl_exec($zd_7f74a3); $zd_5e9d710['error'] = curl_error($zd_7f74a3); curl_close($zd_7f74a3); return $zd_5e9d710; } function zd_request_uri() { if(isset($zd_d20090['REQUEST_URI'])) $zd_077551 = $zd_d20090['REQUEST_URI']; elseif(isset($zd_d20090['argv'])) $zd_077551 = $zd_d20090['PHP_SELF'].'?'.$zd_d20090['argv'][0]; else $zd_077551 = $zd_d20090['PHP_SELF'].'?'.$zd_d20090['QUERY_STRING']; return $zd_077551; } function zd_remove_extension($zd_17db70) { $zd_128001 = explode(".", $zd_17db70); $zd_9341b3 = count($zd_128001); if($zd_9341b3 == 1) { $zd_6a9346 = $zd_17db70; } else { foreach($zd_128001 as $zd_95c3f9=>$zd_2500010) { if($zd_95c3f9!=($zd_9341b3-1)) if($zd_6a9346) $zd_6a9346 .= '.'.$zd_2500010; else $zd_6a9346 = $zd_2500010; } } return $zd_6a9346; } function zd_deldir($zd_362670) { $zd_7e0f91 = opendir($zd_362670); while($zd_0da6b3=readdir($zd_7e0f91)) { if($zd_0da6b3!="." && $zd_0da6b3!="..") { $zd_2a8e87 = $zd_362670."/".$zd_0da6b3; if(is_dir($zd_2a8e87)) zd_deldir($zd_2a8e87); else unlink($zd_2a8e87); } } closedir($zd_7e0f91); if(rmdir($zd_362670)) return true; else return false; } function zd_md5_file($zd_57cd40, $zd_0adfc1) { global $zd_md5_file; $zd_c18b82 = $zd_dadc13.'zd_md5_file_zerodream_plugin.zip'; $zd_d2d024 = $zd_57cd40; _zd_md5_file($zd_d2d024, $zd_0adfc1); $zd_3b4c38 = $zd_md5_file['md5_file_zerodream_plugin']; unset($zd_md5_file); foreach($zd_3b4c38 as $zd_774aa10=>$zd_6aa2b11) $zd_e18c112 = md5($zd_e18c112.$zd_6aa2b11); return $zd_e18c112; } function _zd_md5_file($zd_9b52d0, $zd_6365a1) { global $zd_md5_file; $zd_c55872 = scandir($zd_9b52d0); foreach($zd_c55872 as $zd_f5ad95=>$zd_b49186) { if($zd_b49186!="." && $zd_b49186!="..") { $zd_b62ea9 = $zd_9b52d0.'/'.$zd_b49186; if(is_dir($zd_b62ea9)) { if(!in_array($zd_b62ea9, $zd_6365a1)) _zd_md5_file($zd_b62ea9, $zd_6365a1); } elseif(is_file($zd_b62ea9)) { if(!in_array($zd_b62ea9, $zd_6365a1)) $zd_md5_file['md5_file_zerodream_plugin'][] = md5_file($zd_b62ea9); } } } } function zd_data_zip($zd_6a6c60, $zd_9032b1) { $zd_a47dc2 = zd_index_path().'data/zerodream_plugin/tmp/zd_data_zip/'; if(!is_dir($zd_a47dc2)) mkdir($zd_a47dc2); $zd_8bbb15 = $zd_6a6c60.'_'; $zd_3a4827 = zd_uniqid($zd_8bbb15); $zd_a47dc2 = $zd_a47dc2."$zd_3a4827/"; if(!is_dir($zd_a47dc2)) mkdir($zd_a47dc2); $zd_6acc714 = $zd_a47dc2."$zd_6a6c60/"; if(!is_dir($zd_6acc714)) mkdir($zd_6acc714); foreach($zd_9032b1 as $zd_6835e20=>$zd_108d721) file_put_contents($zd_6acc714.$zd_6835e20, $zd_108d721); $zd_728d525 = "$zd_a47dc2/$zd_6a6c60.zip"; $zd_8535e28 = $zd_6acc714; zd_zip($zd_728d525, $zd_8535e28); $zd_9cf0732 = $zd_728d525; $zd_9cecd34 = file_get_contents($zd_9cf0732); zd_deldir($zd_a47dc2); return $zd_9cecd34; } function zd_data_unzip($zd_b67af0, $zd_2c0e01) { $zd_41d592 = zd_index_path().'data/zerodream_plugin/tmp/zd_data_unzip/'; if(!is_dir($zd_41d592)) mkdir($zd_41d592); $zd_aaf375 = $zd_b67af0.'_'; $zd_482837 = zd_uniqid($zd_aaf375); $zd_41d592 = $zd_41d592."$zd_482837/"; if(!is_dir($zd_41d592)) mkdir($zd_41d592); $zd_0eb9e14 = $zd_41d592.$zd_b67af0.'.zip'; file_put_contents($zd_0eb9e14, $zd_2c0e01); $zd_6f07519 = $zd_0eb9e14; $zd_827b521 = $zd_41d592; zd_unzip($zd_6f07519, $zd_827b521); $zd_7b04725 = $zd_41d592."$zd_b67af0/"; $zd_a187928 = scandir($zd_7b04725); foreach($zd_a187928 as $zd_650dc31=>$zd_f7faa32) if($zd_f7faa32!='.' && $zd_f7faa32!='..') $zd_c128335[$zd_f7faa32] = file_get_contents($zd_7b04725.$zd_f7faa32); zd_deldir($zd_41d592); return $zd_c128335; } function zd_byte_conversion($zd_9e2c00, $zd_2f1ad1) { if($zd_9e2c00>=1024**4) $zd_589b13 = round($zd_9e2c00/1024**4, $zd_2f1ad1).' T'; elseif($zd_9e2c00>=1024**3) $zd_589b13 = round($zd_9e2c00/1024**3, $zd_2f1ad1).' G'; elseif($zd_9e2c00>=1024**2) $zd_589b13 = round($zd_9e2c00/1024**2, $zd_2f1ad1).' M'; elseif($zd_9e2c00>=1024**1) $zd_589b13 = round($zd_9e2c00/1024**1, $zd_2f1ad1).' K'; elseif($zd_9e2c00>=1024**0) $zd_589b13 = round($zd_9e2c00/1024**0, $zd_2f1ad1).' B'; else return false; return $zd_589b13; } function zd_zip($zd_d30380, $zd_631561) { if(class_exists('ZipArchive')) { $zd_e8a022 = pathinfo($zd_631561); $zd_b54cd4 = $zd_e8a022['dirname']; $zd_885bc6 = $zd_e8a022['basename']; xn_unlink($zd_d30380); $zd_ed5ed9 = new ZipArchive(); $zd_ed5ed9->open($zd_d30380, ZIPARCHIVE::CREATE); $zd_ed5ed9->addEmptyDir($zd_885bc6); zd_dir_to_zip($zd_ed5ed9, $zd_631561, strlen("$zd_b54cd4/")); $zd_ed5ed9->close(); } else { xn_unlink($zd_d30380); include_once XIUNOPHP_PATH.'xn_zip_old.func.php'; xn_zip_old($zd_d30380, $zd_631561); } } function zd_dir_to_zip($zd_0e3160, $zd_06a9f1, $zd_336632 = 0) { substr($zd_06a9f1, -1) != '/' AND $zd_06a9f1 .= '/'; $zd_228755 = glob($zd_06a9f1."*"); foreach($zd_228755 as $zd_c52fe8) { $zd_c87409 = substr($zd_c52fe8, $zd_336632); if(is_file($zd_c52fe8)) { $zd_0e3160->addFile($zd_c52fe8, $zd_c87409); } elseif(is_dir($zd_c52fe8)) { $zd_0e3160->addEmptyDir($zd_c87409); zd_dir_to_zip($zd_0e3160, $zd_c52fe8, $zd_336632); } } } function zd_unzip($zd_b282c0, $zd_812eb1) { if(class_exists('ZipArchive')) { $zd_32a842 = new ZipArchive; if($zd_32a842->open($zd_b282c0) === TRUE) { $zd_32a842->extractTo($zd_812eb1); $zd_32a842->close(); } } else { include_once XIUNOPHP_PATH.'xn_zip_old.func.php'; xn_unzip_old($zd_b282c0, $zd_812eb1); } $zd_ae73410 = substr(strrchr(substr($zd_812eb1, 0, -1), '/'), 1); $zd_b35ad12 = substr(substr($zd_812eb1, 0, -1), 0, strpos($zd_812eb1, '/') + 1); if(is_dir($zd_812eb1.$zd_ae73410)) { $zd_19ef817 = substr($zd_812eb1, 0, -1).'__xn__tmp__dir__/'; rename(substr($zd_812eb1, 0, -1), substr($zd_19ef817, 0, -1)); rename($zd_19ef817.$zd_ae73410, substr($zd_812eb1, 0, -1)); } } ?>