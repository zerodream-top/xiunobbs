
<?php

/*
    Powered by ZeroDream
	https://www.zerodream.top/xiuno.htm
	
	修改文件将有禁止使用帐户风险
*/

 define('DEFINED_ZERODREAM_FUNCTION', true); if(zd_index_path()) $include_path = ADMIN_PATH; else $include_path = APP_PATH; include _include($include_path.zd_index_path().'plugin/zerodream_plugin/model/zerodream_kv.func.php'); include _include($include_path.zd_index_path().'plugin/zerodream_plugin/model/zerodream_xiuno.func.php'); function zd_index_path() { if(defined('SKIP_ROUTE')) $zd_5319c_0 = '../'; return $zd_5319c_0; } function zd_url_rewrite() { global $conf; if(!$conf['url_rewrite_on']) $zd_69fca_0 = '?'; return $zd_69fca_0; } function zd_check_plugin($plugin) { $zd_d7360_0 = zd_index_path()."plugin/$plugin/conf.json"; if(!is_file($zd_d7360_0)) return false; $zd_c5653_2 = file_get_contents($zd_d7360_0); $zd_8a720_4 = json_decode($zd_c5653_2, true); if($zd_8a720_4['installed'] && $zd_8a720_4['enable']) $zd_25745_8 = true; else $zd_25745_8 = false; return $zd_25745_8; } function zd_uniqid($prefix='') { $zd_20f9e_0 = $prefix.md5(uniqid(mt_rand(),true)); return $zd_20f9e_0; } function zd_curl($url, $data=null, $array=array()) { if(!isset($array['method'])) $array['method'] = 'GET'; $zd_92b18_0 = curl_init(); $zd_70606_1 = array( CURLOPT_URL => $url, CURLOPT_CUSTOMREQUEST => $array['method'], CURLOPT_POSTFIELDS => $data, CURLOPT_RETURNTRANSFER => true, CURLOPT_SSL_VERIFYPEER => false, CURLOPT_SSL_VERIFYHOST => false, CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_0, CURLOPT_IPRESOLVE => CURL_IPRESOLVE_V4, CURLOPT_HTTPHEADER => array( "Expect: ", "Accept: application/json", "Content-Type: application/json; charset=utf-8", "Content-Length: ".strlen($data), ), ); curl_setopt_array($zd_92b18_0, $zd_70606_1); $zd_a7f8d_4['data'] = curl_exec($zd_92b18_0); $zd_a7f8d_4['error'] = curl_error($zd_92b18_0); if(!empty($array['getinfo'])) $zd_a7f8d_4['info'] = curl_getinfo($zd_92b18_0); curl_close($zd_92b18_0); return $zd_a7f8d_4; } function zd_request_uri() { if(isset($_SERVER['REQUEST_URI'])) $zd_697c2_0 = $_SERVER['REQUEST_URI']; elseif(isset($_SERVER['argv'])) $zd_697c2_0 = $_SERVER['PHP_SELF'].'?'.$_SERVER['argv'][0]; else $zd_697c2_0 = $_SERVER['PHP_SELF'].'?'.$_SERVER['QUERY_STRING']; return $zd_697c2_0; } function zd_remove_extension($name_str) { $zd_41810_0 = explode(".", $name_str); $zd_3261a_1 = count($zd_41810_0); if($zd_3261a_1 == 1) { $zd_2c558_4 = $name_str; } else { foreach($zd_41810_0 as $zd_af4d7_6=>$zd_4bec7_7) { if($zd_af4d7_6!=($zd_3261a_1-1)) if($zd_2c558_4) $zd_2c558_4 .= '.'.$zd_4bec7_7; else $zd_2c558_4 = $zd_4bec7_7; } } return $zd_2c558_4; } function zd_deldir($path) { $zd_e9a6b_0 = opendir($path); while($zd_c3a6b_1=readdir($zd_e9a6b_0)) { if($zd_c3a6b_1!="." && $zd_c3a6b_1!="..") { $zd_69a52_5 = $path."/".$zd_c3a6b_1; if(is_dir($zd_69a52_5)) zd_deldir($zd_69a52_5); else unlink($zd_69a52_5); } } closedir($zd_e9a6b_0); if(rmdir($path)) return true; else return false; } function zd_md5_file($filename, $exclude_filename) { global $zd_md5_file; $zd_42787_0 = $zd_667b1_1.'zd_md5_file_zerodream_plugin.zip'; $zd_be4f9_2 = $filename; _zd_md5_file($zd_be4f9_2, $exclude_filename); $zd_ae0cc_4 = $zd_md5_file['md5_file_zerodream_plugin']; unset($zd_md5_file); foreach($zd_ae0cc_4 as $zd_06791_6=>$zd_fccbb_7) $zd_136a7_8 = md5($zd_136a7_8.$zd_fccbb_7); return $zd_136a7_8; } function _zd_md5_file($directory, $exclude_filename) { global $zd_md5_file; $zd_011d9_0 = scandir($directory); foreach($zd_011d9_0 as $zd_7653a_2=>$zd_c6036_3) { if($zd_c6036_3!="." && $zd_c6036_3!="..") { $zd_d8e5d_6 = $directory.'/'.$zd_c6036_3; if(is_dir($zd_d8e5d_6)) { if(!in_array($zd_d8e5d_6, $exclude_filename)) _zd_md5_file($zd_d8e5d_6, $exclude_filename); } elseif(is_file($zd_d8e5d_6)) { if(!in_array($zd_d8e5d_6, $exclude_filename)) $zd_md5_file['md5_file_zerodream_plugin'][] = md5_file($zd_d8e5d_6); } } } } function zd_data_zip($name, $data) { // hook zd_data_zip_start.php $zd_646d7_0 = zd_index_path().'data/zerodream_plugin/tmp/zd_data_zip/'; if(!is_dir($zd_646d7_0)) mkdir($zd_646d7_0); $zd_b1d7d_3 = $name.'_'; $zd_4499f_4 = zd_uniqid($zd_b1d7d_3); $zd_646d7_0 = $zd_646d7_0."$zd_4499f_4/"; if(!is_dir($zd_646d7_0)) mkdir($zd_646d7_0); $zd_e69c7_11 = $zd_646d7_0."$name/"; if(!is_dir($zd_e69c7_11)) mkdir($zd_e69c7_11); foreach($data as $zd_a2f9b_15=>$zd_9466d_16) file_put_contents($zd_e69c7_11.$zd_a2f9b_15, $zd_9466d_16); $zd_26102_20 = "$zd_646d7_0/$name.zip"; $zd_3bf21_22 = $zd_e69c7_11; zd_zip($zd_26102_20, $zd_3bf21_22); $zd_d0212_26 = $zd_26102_20; $zd_2d006_28 = file_get_contents($zd_d0212_26); zd_deldir($zd_646d7_0); // hook zd_data_zip_end.php return $zd_2d006_28; } function zd_data_unzip($name, $data) { // hook zd_data_unzip_start.php $zd_8e26c_0 = zd_index_path().'data/zerodream_plugin/tmp/zd_data_unzip/'; if(!is_dir($zd_8e26c_0)) mkdir($zd_8e26c_0); $zd_ec18c_3 = $name.'_'; $zd_023f7_4 = zd_uniqid($zd_ec18c_3); $zd_8e26c_0 = $zd_8e26c_0."$zd_023f7_4/"; if(!is_dir($zd_8e26c_0)) mkdir($zd_8e26c_0); $zd_c9bf9_11 = $zd_8e26c_0.$name.'.zip'; file_put_contents($zd_c9bf9_11, $data); $zd_11b35_14 = $zd_c9bf9_11; $zd_060ae_16 = $zd_8e26c_0; zd_unzip($zd_11b35_14, $zd_060ae_16); $zd_a2049_20 = $zd_8e26c_0."$name/"; $zd_68e4d_22 = scandir($zd_a2049_20); foreach($zd_68e4d_22 as $zd_3be3e_25=>$zd_45b61_26) if($zd_45b61_26!='.' && $zd_45b61_26!='..') $zd_c593e_29[$zd_45b61_26] = file_get_contents($zd_a2049_20.$zd_45b61_26); zd_deldir($zd_8e26c_0); // hook zd_data_unzip_end.php return $zd_c593e_29; } function zd_byte_conversion($byte, $precision) { if($byte>=1024**4) $zd_10273_0 = round($byte/1024**4, $precision).' T'; elseif($byte>=1024**3) $zd_10273_0 = round($byte/1024**3, $precision).' G'; elseif($byte>=1024**2) $zd_10273_0 = round($byte/1024**2, $precision).' M'; elseif($byte>=1024**1) $zd_10273_0 = round($byte/1024**1, $precision).' K'; elseif($byte>=1024**0) $zd_10273_0 = round($byte/1024**0, $precision).' B'; else return false; return $zd_10273_0; } function zd_zip($zipfile, $extdir) { if(class_exists('ZipArchive')) { $zd_c81b2_0 = pathinfo($extdir); $zd_8434a_1 = $zd_c81b2_0['dirname']; $zd_f96dc_3 = $zd_c81b2_0['basename']; xn_unlink($zipfile); $zd_fa9ad_5 = new ZipArchive(); $zd_fa9ad_5->open($zipfile, ZIPARCHIVE::CREATE); $zd_fa9ad_5->addEmptyDir($zd_f96dc_3); zd_dir_to_zip($zd_fa9ad_5, $extdir, strlen("$zd_8434a_1/")); $zd_fa9ad_5->close(); } else { xn_unlink($zipfile); include_once XIUNOPHP_PATH.'xn_zip_old.func.php'; xn_zip_old($zipfile, $extdir); } } function zd_dir_to_zip($z, $zippath, $prelen = 0) { substr($zippath, -1) != '/' AND $zippath .= '/'; $zd_828a0_0 = glob($zippath."*"); foreach($zd_828a0_0 as $zd_39026_2) { $zd_e0a19_3 = substr($zd_39026_2, $prelen); if(is_file($zd_39026_2)) { $z->addFile($zd_39026_2, $zd_e0a19_3); } elseif(is_dir($zd_39026_2)) { $z->addEmptyDir($zd_e0a19_3); zd_dir_to_zip($z, $zd_39026_2, $prelen); } } } function zd_unzip($zipfile, $extdir) { if(class_exists('ZipArchive')) { $zd_c3747_0 = new ZipArchive; if($zd_c3747_0->open($zipfile) === TRUE) { $zd_c3747_0->extractTo($extdir); $zd_c3747_0->close(); } } else { include_once XIUNOPHP_PATH.'xn_zip_old.func.php'; xn_unzip_old($zipfile, $extdir); } $extdirlast = substr(strrchr(substr($extdir, 0, -1), '/'), 1); $extdirp = substr(substr($extdir, 0, -1), 0, strpos($extdir, '/') + 1); if(is_dir($extdir.$extdirlast)) { $extdirtmp = substr($extdir, 0, -1).'__xn__tmp__dir__/'; rename(substr($extdir, 0, -1), substr($extdirtmp, 0, -1)); rename($extdirtmp.$extdirlast, substr($extdir, 0, -1)); } } ?>